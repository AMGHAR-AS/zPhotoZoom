var zPhotoZoomLib=function(e){"use strict";var t=Object.defineProperty,n=(e,n,i)=>((e,n,i)=>n in e?t(e,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[n]=i)(e,"symbol"!=typeof n?n+"":n,i);function i(e,t,n,i){const s=t.width/t.height;let a,r;if(e.landscape)a=8*t.width/10,r=a/e.prop,r>t.height&&(r=9*t.height/10,a=r*e.prop);else if(s>=e.prop)r=9*t.height/10,a=r*e.prop;else{const n=e.prop-s;r=9*t.height/10-8*t.height/10*n,a=r*e.prop}let o=Math.min(a/e.width,r/e.height);return"number"!=typeof n||n<=0?o<(n=.3)&&(n=o):o<n&&(o=n),"number"!=typeof i||i<n?o>(i=5)&&(i=o,o=3):o>i&&(o=i),{width:a,height:r,x:(t.width-a)/2,y:(t.height-r)/2,scale:o,min:n,max:i}}function s(){const e=this,t=this._process;let n=!1,i=!1;if(e._callPluginHook("beforeClose",{preventDefault:()=>{n=!0},stopPropagation:()=>{i=!0},target:t.currentImage.image.node,instance:e}),!n){for(let s=0;s<t.eventsClose.length;s++){if(t.eventsClose[s]({preventDefault:()=>{n=!0},stopPropagation:()=>{i=!0},target:t.currentImage.image.node,instance:e}),n)return;if(i)break}t.flags={isAnimated:!1,isMoved:!1,wheel:!1,movements:0,updateAttempt:!1,updated:!1,zoomIn:!1,loader:!1,stoped:t.flags.stoped};try{t.currentImage.image.evener.remove()}catch(s){}if(t.container)t.preview.container.removeChild(t.currentImage.imageNode),t.preview.evener(!0);else{(t.context.body||t.context.getElementsByTagName("body")[0]).removeChild(t.preview.container)}t.flags.loader&&(clearTimeout(t.flags.loader),t.flags.loader=!1),t.preview=!1,t.loader=!1,e._callPluginHook("afterClose",{preventDefault:()=>{},stopPropagation:()=>{},target:t.currentImage?.image.node||null,instance:e})}}function a(e,t){const n=this._process;n.container||(n.loader&&(n.preview.container.removeChild(n.loader),n.flags.loader&&(clearTimeout(n.flags.loader),n.flags.loader=!1)),e?(n.loader=n.context.createElement("SPAN"),n.loader.innerText=" "+e):n.loader=n.context.createElement("ZLOADER"),n.loader.style.opacity="1",n.preview.container.appendChild(n.loader),t&&r.call(this,t))}function r(e){const t=this._process;t.loader&&(t.flags.loader&&clearTimeout(t.flags.loader),t.loader.style.transition="opacity "+e+"ms",t.flags.loader=setTimeout(()=>{t.preview&&t.preview.container.removeChild(t.loader),t.loader=!1,t.flags.loader=!1},e))}function o(){const e=this,t=this._process;let n,i,a,r=!1,o=!1;function l(e){0===e.button&&(o=!0,t.flags.isMoved||(r=!1))}function c(e){(t.flags.isMoved||o)&&(r=!0)}function h(n){const i=t.context.body||t.context.getElementsByTagName("body")[0];if((this===n.target||!i)&&!r&&o)try{s.call(e)}catch(a){}r=!1,o=!1,n.stopPropagation(),n.preventDefault()}return t.container?(i=t.container,a=t.context):(i=t.context.createElement("DIV"),i.setAttribute("class","ZPhotoZoom"),n=t.context.body||t.context.getElementsByTagName("body")[0],a=i),{container:i,apply:function(){n&&n.appendChild(i)},evener:function(e){e?(a.removeEventListener("mousedown",l),a.removeEventListener("mousemove",c),a.removeEventListener("mouseup",h)):setTimeout(function(){a.addEventListener("mousedown",l),a.addEventListener("mousemove",c),a.addEventListener("mouseup",h)},100)}}}function l(e){const t=this,n=this._process;let s,r=!1,l=!1;if(t._callPluginHook("beforeOpen",{preventDefault:()=>{r=!0},stopPropagation:()=>{l=!0},target:e.node,instance:t}),r)return;for(let i=0;i<n.eventsOpen.length;i++){if(n.eventsOpen[i]({preventDefault:()=>{r=!0},stopPropagation:()=>{l=!0},target:e.node,instance:t}),r)return;if(l)break}let h={};n.preview=o.call(t),e.loaded?(s=e.imageNode,n.preview.container.appendChild(s),h=i(e,c.call(t).nf,n.scaleLimit.min,n.scaleLimit.max),f.call(t,h.scale,{x:h.x/h.scale,y:h.y/h.scale})):a.call(t),n.preview.apply(),n.preview.evener();const u=c.call(t).nf;n.currentImage={image:e,imageNode:s,animate:!1,factor:h.scale,distanceFactor:1,scale:h.scale,origin:h,center:{x:u.cx,y:u.cy},minScale:h.min,maxScale:h.max,x:h.x,y:h.y,width:function(){return n.currentImage.imageNode.offsetWidth},height:function(){return n.currentImage.imageNode.offsetHeight}},e.loaded&&e.evener.apply(),t._callPluginHook("afterOpen",{preventDefault:()=>{},stopPropagation:()=>{},target:e.node,instance:t})}function c(){const e=this._process.container;if(e){const t=this._process.container.getBoundingClientRect();return{container:e,nf:{width:t.width,height:t.height,top:t.top,left:t.left,cx:t.left+t.width/2,cy:t.top+t.height/2,x:0,y:0}}}return{container:null,nf:{width:window.innerWidth,height:window.innerHeight,top:0,left:0,cx:window.innerWidth/2,cy:window.innerHeight/2,x:0,y:0}}}function h(e){const t=this,n=this._process;let i=0,s=null,a=!1,r=!1,o=null;function l(e){let i=0,s=0;const a=n.context.documentElement.scrollTop||n.context.body.scrollTop,r=n.context.documentElement.scrollLeft||n.context.body.scrollLeft,o=c.call(t).nf;i=o.top+a,s=o.left+r;const l=[];for(let t=0;t<e.length;t++)l.push({x:e[t].pageX-s,y:e[t].pageY-i});return l}function h(e){if(!r){const n=(new Date).getTime();return n-o<320&&(d.call(t,s[0]),m(),e.stopPropagation(),e.preventDefault()),n}return 0}function m(e){o=e||null,a=!1}function f(){s=null,r=!1}function b(e){if("mousedown"===e.type){const t=e;0===t.button&&(a=!0,s=l([t]),e.stopPropagation(),e.preventDefault())}else if("touchstart"===e.type){const t=e;a=!0,i=t.touches.length,s=l(t.touches)}}function v(e){if(!a&&!s){let n=1;e.deltaY<0&&(n=-1),p.call(t,l([e])[0],n),e.stopPropagation(),e.preventDefault()}}function x(e){if(a)if(0===e.button){r=!0;const n=l([e]);s&&u.call(t,s[0],n[0]),s=n,e.stopPropagation(),e.preventDefault()}else m(o),f()}function w(e){if(i>0)if(s)if(1===i){r=!0;const n=l(e.touches);u.call(t,s[0],n[0]),s=n,e.stopPropagation(),e.preventDefault()}else i>=2&&(s.length<2?s=l(e.touches):(g.call(t,s,l(e.touches)),e.stopPropagation(),e.preventDefault()));else s=l(e.touches)}function y(e){0===e.button&&(a&&(o=h(e)),m(o),f())}function I(e){a?(1===i&&(o=h(e),f(),n.currentImage.distanceFactor=1),i=e.touches.length,0===i?(m(),f(),n.flags.movements=0,n.currentImage.distanceFactor=1):f()):(n.flags.movements=0,n.currentImage.distanceFactor=1,m(),f())}return{remove:function(){e.removeEventListener("wheel",v,{passive:!1}),e.removeEventListener("mousedown",b,{passive:!1}),e.removeEventListener("touchstart",b,{passive:!1}),e.removeEventListener("mousemove",x),e.removeEventListener("touchmove",w,{passive:!1}),n.context.removeEventListener("mouseup",y,{passive:!1,capture:!0}),n.context.removeEventListener("touchend",I,{passive:!1,capture:!0})},apply:function(){i=0,s=null,a=!1,r=!1,o=null,e.addEventListener("wheel",v,{passive:!1}),e.addEventListener("mousedown",b,{passive:!1}),e.addEventListener("touchstart",b,{passive:!1}),e.addEventListener("mousemove",x),e.addEventListener("touchmove",w,{passive:!1}),n.context.addEventListener("mouseup",y,{passive:!1,capture:!0}),n.context.addEventListener("touchend",I,{passive:!1,capture:!0})}}}function u(e,t){const n=this._process;n.flags.movements||n.flags.isAnimated||(n.flags.isMoved=!0,n.currentImage.x+=t.x-e.x,n.currentImage.y+=t.y-e.y,f.call(this,n.currentImage.factor,{x:n.currentImage.x/n.currentImage.factor,y:n.currentImage.y/n.currentImage.factor},!1))}function p(e,t){const n=this._process;if(n.flags.updateAttempt||n.flags.stoped)return;t>0?n.currentImage.scale-=.05:n.currentImage.scale+=.05;const i=n.currentImage.factor;n.currentImage.scale=Math.min(n.currentImage.maxScale,Math.max(n.currentImage.scale,n.currentImage.minScale)),n.currentImage.factor=n.currentImage.scale;const s=n.currentImage.imageNode.getBoundingClientRect(),a=c.call(this).nf;n.currentImage.x-=(n.currentImage.factor/i-1)*(e.x-s.left+a.left),n.currentImage.y-=(n.currentImage.factor/i-1)*(e.y-s.top+a.top),f.call(this,n.currentImage.factor,{x:n.currentImage.x/n.currentImage.factor,y:n.currentImage.y/n.currentImage.factor}),n.currentImage.center=e,n.flags.wheel=setTimeout(function(){n.flags.wheel=!1},600)}function d(e){const t=this._process;if(!(t.flags.isAnimated||t.flags.updateAttempt||t.flags.stoped))if(t.currentImage.scale<=t.currentImage.origin.scale){const n=t.currentImage.factor,i=t.currentImage.imageNode.getBoundingClientRect(),s=c.call(this).nf;t.currentImage.scale=Math.min(t.currentImage.maxScale,Math.max(t.currentImage.scale+2,t.currentImage.minScale)),t.currentImage.factor=t.currentImage.scale,t.currentImage.x-=(t.currentImage.factor/n-1)*(e.x-i.left+s.left),t.currentImage.y-=(t.currentImage.factor/n-1)*(e.y-i.top+s.top),t.currentImage.center=e,f.call(this,t.currentImage.factor,{x:t.currentImage.x/t.currentImage.factor,y:t.currentImage.y/t.currentImage.factor},!0)}else m.call(this)}function m(){const e=this._process;e.currentImage.scale=e.currentImage.origin.scale,e.currentImage.factor=e.currentImage.origin.scale,e.currentImage.x=e.currentImage.origin.x,e.currentImage.y=e.currentImage.origin.y,e.currentImage.minScale=e.currentImage.origin.min,e.currentImage.maxScale=e.currentImage.origin.max;const t=c.call(this).nf;e.currentImage.center={x:t.cx,y:t.cy},f.call(this,e.currentImage.factor,{x:e.currentImage.x/e.currentImage.factor,y:e.currentImage.y/e.currentImage.factor},!0)}function g(e,t){const n=this,i=this._process;if(i.flags.updateAttempt||i.flags.stoped)return;const s=i.currentImage.distanceFactor;i.currentImage.distanceFactor=function(e,t){function n(e,t){const n=e.x-t.x,i=e.y-t.y;return Math.sqrt(n*n+i*i)}return n(t[0],t[1])/n(e[0],e[1])}(e,t);const a=i.currentImage.distanceFactor/s;a<1?i.flags.zoomIn||(i.flags.zoomIn=!0):i.flags.zoomIn&&(i.flags.zoomIn=!1),i.currentImage.scale*=a;const r=function(e){if(1===e.length)return{x:e[0].x,y:e[0].y};{const t=Array.prototype.slice.call(e).map(e=>({x:e.x,y:e.y}));return{x:t.map(e=>e.x).reduce((e,t)=>e+t)/t.length,y:t.map(e=>e.y).reduce((e,t)=>e+t)/t.length}}}(t),o=i.currentImage.factor;i.currentImage.factor=Math.min(i.currentImage.maxScale,Math.max(i.currentImage.scale,i.currentImage.minScale));const l=i.currentImage.imageNode.getBoundingClientRect();if(i.flags.movements&&i.flags.movements>1){const e=c.call(n).nf;i.currentImage.x-=(i.currentImage.factor/o-1)*(r.x-l.left+e.left)-(r.x-i.currentImage.center.x),i.currentImage.y-=(i.currentImage.factor/o-1)*(r.y-l.top+e.top)-(r.y-i.currentImage.center.y),i.flags.updated||i.flags.isAnimated||(i.flags.updated=!0,setTimeout(function(){f.call(n,i.currentImage.factor,{x:i.currentImage.x/i.currentImage.factor,y:i.currentImage.y/i.currentImage.factor}),i.flags.updated=!1},0))}i.currentImage.center=r,i.flags.movements+=1}function f(e,t,n){const i=this._process;if(i.flags.isAnimated)return;i.flags.isAnimated=!0;let s=Math.round(100*e);s<100&&(s=" "+s),a.call(this,s+"%",800),setTimeout(function(){i.flags.isAnimated=!1;const s="scale3d("+e+","+e+",1) translate3d("+t.x+"px,"+t.y+"px,0px)",a="scale("+e+", "+e+") translate("+t.x+"px,"+t.y+"px)";i.currentImage.animate&&clearTimeout(i.currentImage.animate),n?i.currentImage.animate=setTimeout(function(){i.currentImage.imageNode.style.transition="",i.currentImage.animate=!1,i.flags.isMoved=!1},500):(i.currentImage.imageNode.style.transition="",i.currentImage.animate=setTimeout(function(){i.flags.isMoved=!1},100)),i.currentImage.imageNode.style.transformOrigin="top left",i.currentImage.imageNode.style.webkitTransformOrigin="top left",i.currentImage.imageNode.style.transform=s,i.currentImage.imageNode.style.webkitTransform=s,i.currentImage.imageNode.style.mozTransform=a,i.currentImage.imageNode.style.msTransform=a,i.currentImage.imageNode.style.oTransform=a})}function b(){const e=this,t=this._process,n=t.selector,s=t.context;function a(n){!function(e,t){const n=new Image;n.onload=function(){const e=this.height,n=this.width;t.call(this,n,e)},n.src=e}(n.src,function(s,a){n.imageNode=this,n.loaded=!0,n.width=s,n.height=a,n.prop=s/a,n.landscape=s>=a,n.evener=h.call(e,this),t.preview&&t.currentImage.image===n&&(t.currentImage.imageNode=this,t.preview.container.appendChild(t.currentImage.imageNode),t.currentImage.origin=i(n,c.call(e).nf,t.scaleLimit.min,t.scaleLimit.max),r.call(e,480),m.call(e),n.evener.apply())})}const o=[];let l=[];if(n&&"string"==typeof n&&s&&Node.DOCUMENT_NODE===s.nodeType)if(/\s+[^#]|>|\[|\.|,/.test(n))l=Array.from(s.querySelectorAll(n));else{const e=s.querySelector(n);e&&(l=[e])}if((Array.isArray(l)||l instanceof NodeList)&&l.length>0)for(let i=0;i<l.length;i++){const e=l[i],t={node:e,src:""};let n=!1;if("IMG"===e.tagName&&e.src)n=e.src;else{const t=getComputedStyle(e).backgroundImage;if(t)if(/^url\(/.test(t))try{const e=t.match(/url\(["']?([^"']*)["']?\)/);n=!!e&&e[1]}catch(u){n=!1}else n=!1}n&&(t.src=n,a(t),o.push(t))}return o}function v(e,t){const n=this;let i=!1,s=!1;function a(t){s||l.call(n,e),s=!1,i=!1}function r(){i=!0}function o(){i&&(s=!0)}t?(e.node.removeEventListener("click",a),e.node.removeEventListener("touchstart",r),e.node.removeEventListener("touchend",a),e.node.removeEventListener("touchmove",o)):(e.node.addEventListener("click",a),e.node.addEventListener("touchstart",r),e.node.addEventListener("touchend",a),e.node.addEventListener("touchmove",o))}function x(){const e=this._process;if(e.images=b.call(this),e.images.length>0)for(let t=0;t<e.images.length;t++)v.call(this,e.images[t])}function w(e,t){Object.defineProperty(this,"_process",{value:{preview:null,loader:null,eventsOpen:[],eventsClose:[],images:[],flags:{isAnimated:!1,isMoved:!1,wheel:!1,movements:0,updateAttempt:!1,updated:!1,zoomIn:!1,loader:!1,stoped:!1},container:e.container,scaleLimit:{min:e.min,max:e.max},selector:e.el,context:t||document,currentImage:null},configurable:!1,enumerable:!1,writable:!1})}function y(){const e=this,t=e._process;x.call(e),window.addEventListener("resize",function(){if(t.preview){const n=i(t.currentImage.image,c.call(e).nf,t.scaleLimit.min,t.scaleLimit.max);t.currentImage.origin=n,function n(){t.flags.updateAttempt=setTimeout(function(){t.flags.isAnimated?n():(m.call(e),t.flags.updateAttempt=!1)},70)}()}})}class I{constructor(e,t){if(n(this,"_process"),n(this,"_plugins",new Map),(()=>{if(document.getElementById("z-photo-zoom-styles"))return;const e=document.createElement("style");e.id="z-photo-zoom-styles",e.textContent="\n    .ZPhotoZoom {\n      position: fixed;\n      left: 0;\n      top: 0;\n      width: 100vw;\n      height: 100vh;\n      background-color: rgba(0, 0, 0, 0.7);\n      z-index: 999999999;\n      -webkit-user-select: none;\n      -moz-user-select: none;\n      -ms-user-select: none;\n      user-select: none;\n    }\n\n    .ZPhotoZoom img {\n      position: absolute;\n      cursor: grab;\n    }\n\n    .ZPhotoZoom img:active {\n      cursor: grabbing;\n    }\n\n    .ZPhotoZoom span {\n      color: white;\n      line-height: 30px;\n      font-weight: bold;\n      position: fixed;\n      top: calc(50vh - 25px);\n      left: calc(50vw - 15px);\n      background-color: rgba(114, 123, 135, 0.5);\n      width: 50px;\n      height: 30px;\n      display: inline-block;\n      vertical-align: middle;\n      border-radius: 5px;\n      text-align: center;\n    }\n\n    .ZPhotoZoom zloader {\n      position: fixed;\n      top: calc(50vh - 50px);\n      left: calc(50vw - 50px);\n      width: 40px;\n      height: 40px;\n      display: inline-block;\n      vertical-align: middle;\n      border-radius: 40px;\n      border: 6px solid rgba(114, 123, 135, 0.4);\n    }\n\n    .ZPhotoZoom zloader:after {\n      content: '';\n      position: absolute;\n      top: -6px;\n      left: -6px;\n      bottom: -6px;\n      right: -6px;\n      width: 40px;\n      height: 40px;\n      border-radius: 40px;\n      border: 6px solid transparent;\n      border-top-color: rgba(38, 38, 38, 0.27);\n      -webkit-animation: zPhotoZoomSpin 1s linear infinite;\n      animation: zPhotoZoomSpin 1s linear infinite;\n    }\n\n    @keyframes zPhotoZoomSpin {\n      0% {\n        -webkit-transform: rotate(0deg);\n        transform: rotate(0deg);\n      }\n      100% {\n        -webkit-transform: rotate(360deg);\n        transform: rotate(360deg);\n      }\n    }\n  ",document.head.appendChild(e)})(),!(this instanceof I))return console.error("zPhotoZoom is a class and can only be called with the keyword 'new'");e&&("object"==typeof e&&w.call(this,e,t),"string"==typeof e.el&&y.call(this))}stop(){this._process.flags.stoped=!0}resume(){this._process.flags.stoped=!1}reset(){this._process.preview&&m.call(this)}close(){this._process.preview&&s.call(this)}update(){const e=this._process;e.preview&&f.call(this,e.currentImage.factor,{x:e.currentImage.x/e.currentImage.factor,y:e.currentImage.y/e.currentImage.factor})}change(e){const t=this._process;if("string"==typeof e){t.preview&&s.call(this);for(let e=0;e<t.images.length;e++)v.call(this,t.images[e],!0);t.selector=e,t.images=[],x.call(this)}}onOpen(e,t){const n=this._process;if("function"==typeof e)if(t)for(let i=n.eventsOpen.length-1;i>=0;i--)n.eventsOpen[i]===e&&n.eventsOpen.splice(i,1);else n.eventsOpen.push(e)}onClose(e,t){const n=this._process;if("function"==typeof e)if(t)for(let i=n.eventsClose.length-1;i>=0;i--)n.eventsClose[i]===e&&n.eventsClose.splice(i,1);else n.eventsClose.push(e)}registerPlugin(e){if(this._plugins.has(e.name))return void console.warn(`Plugin "${e.name}" is already registered`);const t={getImageState:()=>this.getImageState(),setImageTransform:(e,t,n,i)=>this.setImageTransform(e,t,n,i),centerImage:e=>this.centerImageWithOptions(e),resetImage:()=>this.reset(),getCurrentImageElement:()=>this.getCurrentImageElement(),getPreviewContainer:()=>this.getPreviewContainer(),isViewerOpen:()=>this.isViewerOpen(),closeViewer:()=>this.close()};this._plugins.set(e.name,{plugin:e,api:t}),e.initialize(this,t),e.onRegister&&e.onRegister()}unregisterPlugin(e){const t=this._plugins.get(e);t?(t.plugin.onDestroy&&t.plugin.onDestroy(),t.plugin.destroy&&t.plugin.destroy(),this._plugins.delete(e)):console.warn(`Plugin "${e}" is not registered`)}getPlugin(e){return this._plugins.get(e)?.plugin}_callPluginHook(e,...t){this._plugins.forEach(({plugin:n})=>{const i=n[e];"function"==typeof i&&i.apply(n,t)})}getImageState(){const e=this._process;return e.currentImage?{scale:e.currentImage.scale,x:e.currentImage.x,y:e.currentImage.y,minScale:e.currentImage.minScale,maxScale:e.currentImage.maxScale}:null}setImageTransform(e,t,n,i){const s=this._process;s.preview&&s.currentImage&&(s.currentImage.scale=e,s.currentImage.factor=e,s.currentImage.x=t,s.currentImage.y=n,f.call(this,e,{x:t/e,y:n/e},i),this._callPluginHook("onTransformChange",this.getImageState()))}centerImageWithOptions(e){const t=this._process;if(!t.preview||!t.currentImage)return;let n=c.call(this).nf;if(e?.reservedSpaces){const{top:t=0,bottom:i=0,left:s=0,right:a=0}=e.reservedSpaces,r=n.width-s-a,o=n.height-t-i;n={...n,width:r,height:o,x:n.x+s,y:n.y+t,cx:n.x+s+r/2,cy:n.y+t+o/2,top:n.top+t,left:n.left+s}}const s=e?.marginPercent??.05;if(s>0){const e=n.width*s,t=n.height*s,i=n.width-2*e,a=n.height-2*t;n={...n,width:i,height:a,x:n.x+e,y:n.y+t,cx:n.x+e+i/2,cy:n.y+t+a/2,top:n.top+t,left:n.left+e}}const a=t.currentImage.image,r=i(a,n,t.scaleLimit.min,t.scaleLimit.max);if(!e?.allowUpscale){const e=Math.min(a.width/r.width,a.height/r.height);r.scale>e&&(r.scale=e,r.width=a.width*r.scale,r.height=a.height*r.scale,r.x=(n.width-r.width)/2,r.y=(n.height-r.height)/2)}t.currentImage.origin=r,this.setImageTransform(r.scale,r.x,r.y,!1)}getCurrentImageElement(){return this._process.currentImage?.imageNode||null}getPreviewContainer(){return this._process.preview?.container||null}isViewerOpen(){return!!this._process.preview}}var z=Object.defineProperty,_=(e,t,n)=>((e,t,n)=>t in e?z(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);const C={ArrowLeft:"previous",ArrowRight:"next",Escape:"close",Home:"first",End:"last",Space:"togglePlay"};class S{constructor(e){_(this,"options"),_(this,"enabled"),_(this,"boundHandler",null),this.options=e,this.enabled=e.enabled,this.enabled&&this.enable()}enable(){this.enabled&&this.boundHandler||(this.enabled=!0,this.boundHandler=this.handleKeyDown.bind(this),document.addEventListener("keydown",this.boundHandler))}disable(){this.enabled&&this.boundHandler&&(this.enabled=!1,document.removeEventListener("keydown",this.boundHandler),this.boundHandler=null)}destroy(){this.disable()}handleKeyDown(e){if(!this.enabled)return;const t=e.target;if(["INPUT","TEXTAREA","SELECT","BUTTON"].includes(t.tagName)||t.isContentEditable||t.closest('[contenteditable="true"]'))return;const n=C[e.key];if(n)switch(e.preventDefault(),e.stopPropagation(),n){case"next":this.options.onNext();break;case"previous":this.options.onPrevious();break;case"close":this.options.onClose();break;case"first":this.options.onFirst();break;case"last":this.options.onLast();break;case"togglePlay":this.options.onTogglePlay&&this.options.onTogglePlay()}}}var P=Object.defineProperty,E=(e,t,n)=>((e,t,n)=>t in e?P(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);class T{constructor(e){if(E(this,"options"),E(this,"images"),E(this,"loadingQueue",new Set),E(this,"loadedIndices",new Set),this.options=e,this.images=e.images||[],!Array.isArray(this.images))return console.error("zPhotoCarousel: Preloader requires an array of images"),void(this.images=[]);this.options.preloadAll&&this.images.length>0&&this.preloadAll().catch(e=>{console.warn("zPhotoCarousel: Error preloading all images:",e)})}async preloadImage(e){if(e<0||e>=this.images.length)return Promise.reject(new Error(`Invalid index: ${e}`));const t=this.images[e];return t?t.loaded||this.loadedIndices.has(e)?Promise.resolve():this.loadingQueue.has(e)?this.waitForLoad(e):(this.loadingQueue.add(e),new Promise(n=>{const i=new Image;i.onload=()=>{t.imageNode=i,t.loaded=!0,t.width=i.naturalWidth,t.height=i.naturalHeight,t.prop=i.naturalWidth/i.naturalHeight,t.landscape=i.naturalWidth>=i.naturalHeight,this.loadedIndices.add(e),this.loadingQueue.delete(e),n()},i.onerror=()=>{console.warn(`zPhotoCarousel: Failed to load image at index ${e}:`,t.src),t.imageNode=i,t.loaded=!0,t.failed=!0,this.loadedIndices.add(e),this.loadingQueue.delete(e),n()},i.src=t.src})):Promise.reject(new Error(`Image data not found at index: ${e}`))}async preloadAdjacent(e){if(!this.options.preloadAdjacent)return Promise.resolve();const t=this.images.length;if(0===t||e<0||e>=t)return Promise.resolve();const n=[],i=(e+1)%t,s=this.images[i];!s||s.loaded||this.loadedIndices.has(i)||n.push(i);const a=0===e?t-1:e-1,r=this.images[a];!r||r.loaded||this.loadedIndices.has(a)||n.push(a);try{await Promise.all(n.map(e=>this.preloadImage(e)))}catch(o){console.warn("zPhotoCarousel: Some adjacent images failed to preload",o)}}async preloadAll(){if(!this.options.preloadAll)return Promise.resolve();const e=[];for(let n=0;n<this.images.length;n++){const t=this.images[n];!t||t.loaded||this.loadedIndices.has(n)||e.push(n)}for(let n=0;n<e.length;n+=3){const i=e.slice(n,n+3);try{await Promise.all(i.map(e=>this.preloadImage(e)))}catch(t){console.warn("zPhotoCarousel: Some images failed to preload in batch",t)}}}waitForLoad(e){return new Promise(t=>{let n;const i=setInterval(()=>{this.loadingQueue.has(e)||(clearInterval(i),clearTimeout(n),t())},50);n=setTimeout(()=>{clearInterval(i),console.warn(`zPhotoCarousel: Preload timeout for image at index ${e}`),t()},1e4)})}getStats(){const e=this.images.length,t=this.loadedIndices.size;return{loaded:t,total:e,percentage:e>0?Math.round(t/e*100):0}}}var k=Object.defineProperty,A=(e,t,n)=>((e,t,n)=>t in e?k(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);class L{constructor(e){A(this,"options"),A(this,"element"),A(this,"startPoint",null),A(this,"enabled",!0),A(this,"boundTouchStart",null),A(this,"boundTouchMove",null),A(this,"boundTouchEnd",null),this.options=e,this.element=e.element,this.enable()}enable(){this.boundTouchStart||(this.enabled=!0,this.boundTouchStart=this.handleTouchStart.bind(this),this.boundTouchMove=this.handleTouchMove.bind(this),this.boundTouchEnd=this.handleTouchEnd.bind(this),this.element.addEventListener("touchstart",this.boundTouchStart,{passive:!1}),this.element.addEventListener("touchmove",this.boundTouchMove,{passive:!1}),this.element.addEventListener("touchend",this.boundTouchEnd,{passive:!1}))}disable(){this.boundTouchStart&&(this.enabled=!1,this.element.removeEventListener("touchstart",this.boundTouchStart),this.element.removeEventListener("touchmove",this.boundTouchMove),this.element.removeEventListener("touchend",this.boundTouchEnd),this.boundTouchStart=null,this.boundTouchMove=null,this.boundTouchEnd=null)}destroy(){this.disable()}handleTouchStart(e){if(this.enabled&&this.options.isEnabled())if(1===e.touches.length){const t=e.touches[0];t&&(this.startPoint={x:t.clientX,y:t.clientY,time:Date.now()})}else this.startPoint=null}handleTouchMove(e){this.enabled&&this.startPoint&&this.options.isEnabled()&&e.touches.length>1&&(this.startPoint=null)}handleTouchEnd(e){if(!this.enabled||!this.startPoint||!this.options.isEnabled())return void(this.startPoint=null);const t=e.changedTouches[0];if(!t)return void(this.startPoint=null);const n={x:t.clientX,y:t.clientY,time:Date.now()};this.detectSwipe(this.startPoint,n),this.startPoint=null}detectSwipe(e,t){const n=t.x-e.x,i=t.y-e.y,s=t.time-e.time,a=Math.abs(n);a<=Math.abs(i)||a<this.options.threshold||s>300||(n>0?this.options.onSwipeRight():this.options.onSwipeLeft())}}var N=Object.defineProperty,O=(e,t,n)=>((e,t,n)=>t in e?N(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);class H{constructor(e){O(this,"options"),O(this,"container",null),O(this,"track",null),O(this,"thumbnails",[]),O(this,"currentIndex"),this.options=e,this.currentIndex=e.currentIndex}render(){this.container=document.createElement("div"),this.container.className=`zpz-thumbnail-bar zpz-tb-${this.options.position}`,this.container.style.height=`${this.options.height}px`;const e=document.createElement("div");return e.className="zpz-tb-container",this.container.appendChild(e),this.track=document.createElement("div"),this.track.className="zpz-tb-track",e.appendChild(this.track),this.options.images.forEach((e,t)=>{const n=this.createThumbnail(e,t);this.thumbnails.push(n),this.track.appendChild(n)}),this.setActive(this.currentIndex),this.container}createThumbnail(e,t){const n=document.createElement("div");n.className="zpz-tb-item",n.setAttribute("data-index",t.toString()),n.setAttribute("role","button"),n.setAttribute("tabindex","0"),n.setAttribute("aria-label",`View image ${t+1}`);"top"===this.options.position||"bottom"===this.options.position?n.style.height="100%":n.style.width="100%";const i=document.createElement("img");return i.src=e.thumbnailSrc||e.src,i.alt=`Thumbnail ${t+1}`,i.draggable=!1,i.style.pointerEvents="none",n.appendChild(i),n.addEventListener("click",()=>{this.options.onThumbnailClick(t)}),n.addEventListener("keydown",e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),this.options.onThumbnailClick(t))}),n}setActive(e){if(e<0||e>=this.thumbnails.length)return;if(this.currentIndex>=0&&this.currentIndex<this.thumbnails.length){const e=this.thumbnails[this.currentIndex];e&&(e.classList.remove("zpz-tb-active"),e.setAttribute("aria-selected","false"))}const t=this.thumbnails[e];t&&(t.classList.add("zpz-tb-active"),t.setAttribute("aria-selected","true")),this.currentIndex=e,this.scrollToActive()}scrollToActive(){if(!this.track||!this.container||this.currentIndex<0)return;const e=this.thumbnails[this.currentIndex];e&&e.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"})}update(e){this.track&&(this.track.innerHTML="",this.thumbnails=[],e.forEach((e,t)=>{const n=this.createThumbnail(e,t);this.thumbnails.push(n),this.track.appendChild(n)}),this.setActive(0))}destroy(){this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container),this.container=null,this.track=null,this.thumbnails=[]}}var M=Object.defineProperty,B=(e,t,n)=>((e,t,n)=>t in e?M(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);class D{constructor(e,t,n="center"){this.onPrevious=e,this.onNext=t,this.position=n,B(this,"container",null),B(this,"prevButton",null),B(this,"nextButton",null)}render(){return this.container=document.createElement("div"),this.container.className=`zpz-nav-arrows zpz-arrows-${this.position}`,this.prevButton=this.createArrowButton("prev",this.onPrevious),this.container.appendChild(this.prevButton),this.nextButton=this.createArrowButton("next",this.onNext),this.container.appendChild(this.nextButton),this.container}createArrowButton(e,t){const n=document.createElement("button");n.className=`zpz-arrow zpz-arrow-${e}`,n.setAttribute("aria-label","prev"===e?"Previous image":"Next image"),n.type="button";const i=this.createArrowIcon(e);return n.appendChild(i),n.addEventListener("click",e=>{e.stopPropagation(),t()}),n}createArrowIcon(e){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");if(t.setAttribute("width","28"),t.setAttribute("height","28"),t.setAttribute("viewBox","0 0 24 24"),t.setAttribute("fill","none"),t.setAttribute("stroke","currentColor"),t.setAttribute("stroke-width","2.5"),t.setAttribute("stroke-linecap","round"),t.setAttribute("stroke-linejoin","round"),"prev"===e){const e=document.createElementNS("http://www.w3.org/2000/svg","path");e.setAttribute("d","M15 18l-6-6 6-6"),t.appendChild(e);const n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttribute("d","M19 18l-6-6 6-6"),n.setAttribute("opacity","0.5"),t.appendChild(n)}else{const e=document.createElementNS("http://www.w3.org/2000/svg","path");e.setAttribute("d","M9 18l6-6-6-6"),t.appendChild(e);const n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttribute("d","M5 18l6-6-6-6"),n.setAttribute("opacity","0.5"),t.appendChild(n)}return t}updateDisabledState(e,t,n){this.prevButton&&this.nextButton&&(n?(this.prevButton.disabled=!1,this.nextButton.disabled=!1):(this.prevButton.disabled=0===e,this.nextButton.disabled=e===t-1))}destroy(){this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container),this.container=null,this.prevButton=null,this.nextButton=null}}var j=Object.defineProperty,W=(e,t,n)=>((e,t,n)=>t in e?j(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);class Z{constructor(e="top-right"){this.position=e,W(this,"container",null),W(this,"currentSpan",null),W(this,"totalSpan",null)}render(){this.container=document.createElement("div"),this.container.className=`zpz-counter zpz-counter-${this.position}`,this.container.setAttribute("aria-live","polite"),this.container.setAttribute("aria-atomic","true"),this.currentSpan=document.createElement("span"),this.currentSpan.className="zpz-counter-current",this.currentSpan.textContent="1";const e=document.createElement("span");return e.className="zpz-counter-separator",e.textContent="/",this.totalSpan=document.createElement("span"),this.totalSpan.className="zpz-counter-total",this.totalSpan.textContent="1",this.container.appendChild(this.currentSpan),this.container.appendChild(e),this.container.appendChild(this.totalSpan),this.container}update(e,t){this.currentSpan&&this.totalSpan&&(this.currentSpan.textContent=e.toString(),this.totalSpan.textContent=t.toString(),this.container&&this.container.setAttribute("aria-label",`Image ${e} of ${t}`))}destroy(){this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container),this.container=null,this.currentSpan=null,this.totalSpan=null}}var F=Object.defineProperty,$=(e,t,n)=>((e,t,n)=>t in e?F(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);return e.default=I,e.zPhotoCarousel=class extends I{constructor(e,t){(()=>{if(document.getElementById("z-photo-carousel-styles"))return;const e=document.createElement("style");e.id="z-photo-carousel-styles",e.textContent="\n    /* Carousel main container modifications */\n    .ZPhotoZoom.zpz-carousel-mode {\n      display: flex;\n      flex-direction: column;\n    }\n\n    .zpz-main-image-container {\n      position: relative;\n      flex: 1;\n      overflow: hidden;\n    }\n\n    .zpz-slides-wrapper {\n      position: absolute;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      display: flex;\n      will-change: transform;\n    }\n\n    .zpz-slides-wrapper.zpz-transitioning {\n      transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);\n    }\n\n    .zpz-slide {\n      position: relative;\n      flex: 0 0 100%;\n      width: 100%;\n      height: 100%;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      opacity: 0;\n      transition: opacity 0.3s ease-in-out;\n    }\n\n    .zpz-slide.zpz-slide-active {\n      opacity: 1;\n    }\n\n    .zpz-slide.zpz-slide-entering {\n      animation: slideEnter 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;\n    }\n\n    @keyframes slideEnter {\n      from {\n        opacity: 0;\n        transform: scale(0.95);\n      }\n      to {\n        opacity: 1;\n        transform: scale(1);\n      }\n    }\n\n    .zpz-slide img {\n      position: absolute;\n      max-width: 100%;\n      max-height: 100%;\n    }\n\n    /* Navigation Arrows */\n    .zpz-nav-arrows {\n      position: absolute;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      pointer-events: none;\n      z-index: 999;\n    }\n\n    .zpz-arrow {\n      pointer-events: auto;\n      position: absolute;\n      top: 50%;\n      transform: translateY(-50%);\n      background: linear-gradient(135deg, rgba(0, 0, 0, 0.7) 0%, rgba(0, 0, 0, 0.5) 100%);\n      backdrop-filter: blur(15px);\n      border: 2px solid rgba(255, 255, 255, 0.15);\n      width: 56px;\n      height: 56px;\n      border-radius: 50%;\n      cursor: pointer;\n      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      color: white;\n      outline: none;\n      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n    }\n\n    .zpz-arrow:hover:not(:disabled) {\n      background: linear-gradient(135deg, rgba(102, 126, 234, 0.9) 0%, rgba(76, 96, 204, 0.8) 100%);\n      border-color: rgba(102, 126, 234, 1);\n      transform: translateY(-50%) scale(1.15);\n      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);\n    }\n\n    .zpz-arrow:hover:not(:disabled) svg {\n      transform: scale(1.1);\n    }\n\n    .zpz-arrow:active:not(:disabled) {\n      transform: translateY(-50%) scale(0.95);\n    }\n\n    .zpz-arrow:disabled {\n      opacity: 0.25;\n      cursor: not-allowed;\n      background: rgba(0, 0, 0, 0.3);\n    }\n\n    .zpz-arrow:focus-visible {\n      outline: 3px solid #667eea;\n      outline-offset: 3px;\n    }\n\n    .zpz-arrow-prev {\n      left: 24px;\n    }\n\n    .zpz-arrow-next {\n      right: 24px;\n    }\n\n    .zpz-arrow svg {\n      width: 28px;\n      height: 28px;\n      fill: none;\n      transition: transform 0.2s ease;\n    }\n\n    /* Counter */\n    .zpz-counter {\n      position: absolute;\n      background: rgba(0, 0, 0, 0.7);\n      backdrop-filter: blur(10px);\n      padding: 8px 16px;\n      border-radius: 20px;\n      color: white;\n      font-size: 16px;\n      font-weight: 500;\n      z-index: 1000;\n      user-select: none;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n    }\n\n    .zpz-counter-top-left {\n      top: 20px;\n      left: 20px;\n    }\n\n    .zpz-counter-top-right {\n      top: 20px;\n      right: 20px;\n    }\n\n    .zpz-counter-bottom-left {\n      bottom: 20px;\n      left: 20px;\n    }\n\n    .zpz-counter-bottom-right {\n      bottom: 20px;\n      right: 20px;\n    }\n\n    .zpz-counter-separator {\n      margin: 0 8px;\n      opacity: 0.6;\n    }\n\n    /* Thumbnail Bar */\n    .zpz-thumbnail-bar {\n      position: absolute;\n      background: linear-gradient(180deg, rgba(0, 0, 0, 0.95) 0%, rgba(0, 0, 0, 0.85) 100%);\n      backdrop-filter: blur(20px);\n      z-index: 1000;\n      border-top: 1px solid rgba(255, 255, 255, 0.1);\n    }\n\n    .zpz-tb-bottom {\n      bottom: 0;\n      left: 0;\n      right: 0;\n    }\n\n    .zpz-tb-top {\n      top: 0;\n      left: 0;\n      right: 0;\n      border-top: none;\n      border-bottom: 1px solid rgba(255, 255, 255, 0.1);\n    }\n\n    .zpz-tb-left {\n      left: 0;\n      top: 0;\n      bottom: 0;\n      border-top: none;\n      border-right: 1px solid rgba(255, 255, 255, 0.1);\n    }\n\n    .zpz-tb-right {\n      right: 0;\n      top: 0;\n      bottom: 0;\n      border-top: none;\n      border-left: 1px solid rgba(255, 255, 255, 0.1);\n    }\n\n    .zpz-tb-container {\n      width: 100%;\n      height: 100%;\n      overflow-x: auto;\n      overflow-y: hidden;\n      padding: 8px 16px;\n      scroll-behavior: smooth;\n      -webkit-overflow-scrolling: touch;\n    }\n\n    .zpz-tb-left .zpz-tb-container,\n    .zpz-tb-right .zpz-tb-container {\n      overflow-x: hidden;\n      overflow-y: auto;\n    }\n\n    /* Custom scrollbar for webkit browsers */\n    .zpz-tb-container::-webkit-scrollbar {\n      height: 6px;\n      width: 6px;\n    }\n\n    .zpz-tb-container::-webkit-scrollbar-track {\n      background: rgba(255, 255, 255, 0.05);\n      border-radius: 3px;\n    }\n\n    .zpz-tb-container::-webkit-scrollbar-thumb {\n      background: rgba(255, 255, 255, 0.2);\n      border-radius: 3px;\n    }\n\n    .zpz-tb-container::-webkit-scrollbar-thumb:hover {\n      background: rgba(255, 255, 255, 0.3);\n    }\n\n    .zpz-tb-track {\n      display: flex;\n      gap: 10px;\n      height: 100%;\n      align-items: center;\n      min-width: min-content;\n    }\n\n    .zpz-tb-bottom .zpz-tb-track,\n    .zpz-tb-tb-top .zpz-tb-track {\n      flex-direction: row;\n    }\n\n    .zpz-tb-left .zpz-tb-track,\n    .zpz-tb-right .zpz-tb-track {\n      flex-direction: column;\n    }\n\n    .zpz-tb-item {\n      flex: 0 0 auto;\n      cursor: pointer;\n      border: 2px solid rgba(255, 255, 255, 0.15);\n      border-radius: 6px;\n      overflow: hidden;\n      transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);\n      background: rgba(255, 255, 255, 0.05);\n      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);\n      position: relative;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n    }\n\n    .zpz-tb-item::after {\n      content: '';\n      position: absolute;\n      inset: 0;\n      background: linear-gradient(180deg, transparent 0%, rgba(0, 0, 0, 0.2) 100%);\n      opacity: 0;\n      transition: opacity 0.25s ease;\n    }\n\n    .zpz-tb-item:hover {\n      border-color: rgba(255, 255, 255, 0.4);\n      transform: translateY(-4px) scale(1.05);\n      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.5);\n    }\n\n    .zpz-tb-item:hover::after {\n      opacity: 1;\n    }\n\n    .zpz-tb-item:focus-visible {\n      outline: 3px solid #667eea;\n      outline-offset: 3px;\n    }\n\n    .zpz-tb-item.zpz-tb-active {\n      border-color: #667eea;\n      border-width: 3px;\n      box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2),\n                  0 4px 20px rgba(102, 126, 234, 0.6);\n      transform: scale(1.1);\n    }\n\n    .zpz-tb-item.zpz-tb-active::after {\n      opacity: 0;\n    }\n\n    .zpz-tb-item img {\n      width: 100%;\n      height: 100%;\n      object-fit: cover;\n      display: block;\n    }\n\n    /* Mobile responsive */\n    @media (max-width: 768px) {\n      .zpz-tb-bottom,\n      .zpz-tb-top {\n        height: 80px !important;\n      }\n\n      .zpz-arrow {\n        width: 48px;\n        height: 48px;\n      }\n\n      .zpz-arrow svg {\n        width: 24px;\n        height: 24px;\n      }\n\n      .zpz-arrow-prev {\n        left: 12px;\n      }\n\n      .zpz-arrow-next {\n        right: 12px;\n      }\n\n      .zpz-counter {\n        font-size: 14px;\n        padding: 6px 12px;\n      }\n    }\n\n    /* Extra small screens */\n    @media (max-width: 480px) {\n      .zpz-arrow {\n        width: 44px;\n        height: 44px;\n      }\n\n      .zpz-arrow svg {\n        width: 22px;\n        height: 22px;\n      }\n\n      .zpz-arrow-prev {\n        left: 8px;\n      }\n\n      .zpz-arrow-next {\n        right: 8px;\n      }\n    }\n  ",document.head.appendChild(e)})(),super(e,t),$(this,"_carouselState"),$(this,"_carouselOptions"),$(this,"_thumbnailBar"),$(this,"_keyboardNav"),$(this,"_preloader"),$(this,"_swipeDetector"),$(this,"_navigationArrows"),$(this,"_counter"),$(this,"_navigateCallbacks",[]),$(this,"_slideChangeCallbacks",[]),$(this,"_mainImageContainer"),$(this,"_slidesWrapper"),$(this,"_slides",new Map),$(this,"_clickHandlers",new Map),$(this,"_hoverHandlers",null),$(this,"_originalEventHandlers",new Map),$(this,"_imageStates",new Map),this._carouselOptions={...e,carousel:!1!==e.carousel,loop:!1!==e.loop,startIndex:e.startIndex||0,enableThumbnails:!1!==e.enableThumbnails,thumbnailHeight:e.thumbnailHeight||120,thumbnailPosition:e.thumbnailPosition||"bottom",thumbnailsVisible:e.thumbnailsVisible||5,enableKeyboard:!1!==e.enableKeyboard,enableArrows:!1!==e.enableArrows,arrowPosition:e.arrowPosition||"center",enableSwipe:!1!==e.enableSwipe,transition:e.transition||"slide",transitionDuration:e.transitionDuration||400,autoPlay:e.autoPlay||!1,autoPlayInterval:e.autoPlayInterval||3e3,pauseOnHover:!1!==e.pauseOnHover,preloadAdjacent:!1!==e.preloadAdjacent,preloadAll:e.preloadAll||!1,showCounter:!1!==e.showCounter,counterPosition:e.counterPosition||"top-right"},this._carouselState={currentIndex:this._carouselOptions.startIndex,totalImages:this.process.images.length,isPlaying:!1,playTimer:null,isTransitioning:!1,direction:null},this.initializeCarousel()}get process(){return this._process}initializeCarousel(){this._carouselOptions.carousel&&(this.process.images.forEach((e,t)=>{e.index=t}),(this._carouselOptions.preloadAdjacent||this._carouselOptions.preloadAll)&&(this._preloader=new T({images:this.process.images,preloadAdjacent:this._carouselOptions.preloadAdjacent,preloadAll:this._carouselOptions.preloadAll})),this.process.images.forEach((e,t)=>{e.evener&&(this._originalEventHandlers.set(e.node,{evener:e.evener}),e.evener.remove());const n=this._clickHandlers.get(e.node);n&&e.node.removeEventListener("click",n);const i=e=>{e.preventDefault(),e.stopPropagation(),this.openCarouselAt(t)};this._clickHandlers.set(e.node,i),e.node.addEventListener("click",i)}))}openCarouselAt(e){this._carouselState.currentIndex=e;const t=this.process.images[e];this.openCarouselViewer(t)}openCarouselViewer(e){let t=!1;for(let n=0;n<this.process.eventsOpen.length;n++){const i={preventDefault:()=>{t=!0},stopPropagation:()=>{},target:e.node,instance:this};if(this.process.eventsOpen[n](i),t)return}this.createCarouselStructure(),this.setupCarouselComponents(),this.displayImage(this._carouselState.currentIndex,!1),this._preloader&&this._preloader.preloadAdjacent(this._carouselState.currentIndex),this._carouselOptions.autoPlay&&this.play()}createCarouselStructure(){if(!this.process.preview){const e=this.getContainerPreview();this.process.preview=e,this.process.preview.apply(),this.process.preview.evener()}const e=this.process.preview.container;e.classList.add("zpz-carousel-mode"),this._mainImageContainer&&this._mainImageContainer.parentNode?(this._mainImageContainer.innerHTML="",this._slides.clear()):(this._mainImageContainer=document.createElement("div"),this._mainImageContainer.className="zpz-main-image-container",e.appendChild(this._mainImageContainer)),this._slidesWrapper=document.createElement("div"),this._slidesWrapper.className="zpz-slides-wrapper",this._mainImageContainer.appendChild(this._slidesWrapper)}setupCarouselComponents(){const e=this.process.preview.container;this._carouselOptions.enableArrows&&(this._navigationArrows=new D(()=>this.previous(),()=>this.next(),this._carouselOptions.arrowPosition),this._mainImageContainer.appendChild(this._navigationArrows.render()),this._navigationArrows.updateDisabledState(this._carouselState.currentIndex,this._carouselState.totalImages,this._carouselOptions.loop)),this._carouselOptions.showCounter&&(this._counter=new Z(this._carouselOptions.counterPosition),this._mainImageContainer.appendChild(this._counter.render()),this._counter.update(this._carouselState.currentIndex+1,this._carouselState.totalImages)),this._carouselOptions.enableThumbnails&&(this._thumbnailBar=new H({images:this.process.images,position:this._carouselOptions.thumbnailPosition,height:this._carouselOptions.thumbnailHeight,visibleCount:this._carouselOptions.thumbnailsVisible,currentIndex:this._carouselState.currentIndex,onThumbnailClick:e=>this.goTo(e)}),e.appendChild(this._thumbnailBar.render())),this._carouselOptions.enableKeyboard&&(this._keyboardNav=new S({onNext:()=>this.next(),onPrevious:()=>this.previous(),onClose:()=>this.close(),onFirst:()=>this.first(),onLast:()=>this.last(),onTogglePlay:()=>this.togglePlay(),enabled:!0})),this._carouselOptions.enableSwipe&&this._mainImageContainer&&(this._swipeDetector=new L({element:this._mainImageContainer,threshold:50,onSwipeLeft:()=>this.next(),onSwipeRight:()=>this.previous(),isEnabled:()=>this.process.currentImage?.scale===this.process.currentImage?.origin.scale})),this._carouselOptions.pauseOnHover&&this._carouselOptions.autoPlay&&this.setupPauseOnHover(e)}getOrCreateSlide(e){let t=this._slides.get(e);return t||(t=document.createElement("div"),t.className="zpz-slide",t.setAttribute("data-index",e.toString()),this._slides.set(e,t)),t}async prepareSlide(e){const t=this.process.images[e];if(!t)return;!t.loaded&&this._preloader&&await this._preloader.preloadImage(e);const n=t.imageNode;if(!n)return;const i=this.getOrCreateSlide(e);i.innerHTML="",i.appendChild(n),e===this._carouselState.currentIndex&&this.updateCurrentImage(t)}async displayImage(e,t=!0){const n=this.process.images[e];if(!n)return void console.error("zPhotoCarousel: Invalid image index:",e);await this.prepareSlide(e);const i=this.getPreviousIndex(),s=this.getNextIndex();if(i!==e&&this.prepareSlide(i).catch(()=>{}),s!==e&&this.prepareSlide(s).catch(()=>{}),this._slidesWrapper.innerHTML="",i!==e){const e=this.getOrCreateSlide(i);e.classList.remove("zpz-slide-active","zpz-slide-entering"),this._slidesWrapper.appendChild(e)}else{const e=document.createElement("div");e.className="zpz-slide",this._slidesWrapper.appendChild(e)}const a=this.getOrCreateSlide(e);if(a.classList.remove("zpz-slide-active","zpz-slide-entering"),this._slidesWrapper.appendChild(a),s!==e){const e=this.getOrCreateSlide(s);e.classList.remove("zpz-slide-active","zpz-slide-entering"),this._slidesWrapper.appendChild(e)}else{const e=document.createElement("div");e.className="zpz-slide",this._slidesWrapper.appendChild(e)}t&&this.process.currentImage?(this._slidesWrapper.classList.remove("zpz-transitioning"),this._slidesWrapper.style.transform="translateX(-100%)",this._slidesWrapper.offsetHeight,this._slidesWrapper.classList.add("zpz-transitioning"),requestAnimationFrame(()=>{a.classList.add("zpz-slide-entering"),setTimeout(()=>{a.classList.remove("zpz-slide-entering"),a.classList.add("zpz-slide-active")},500)})):(this._slidesWrapper.classList.remove("zpz-transitioning"),this._slidesWrapper.style.transform="translateX(-100%)",requestAnimationFrame(()=>{a.classList.add("zpz-slide-entering"),setTimeout(()=>{a.classList.remove("zpz-slide-entering"),a.classList.add("zpz-slide-active")},500)})),this.updateCurrentImage(n)}getCenterImageOptions(){const e={marginPercent:.05,allowUpscale:!1,reservedSpaces:{}};if(this._carouselOptions.enableThumbnails){const t=this._carouselOptions.thumbnailHeight,n=this._carouselOptions.thumbnailPosition;"bottom"===n?e.reservedSpaces.bottom=t:"top"===n?e.reservedSpaces.top=t:"left"===n?e.reservedSpaces.left=t:"right"===n&&(e.reservedSpaces.right=t)}return e}updateCurrentImage(e){const t=e.imageNode,n=e.index;setTimeout(()=>{const i=this._mainImageContainer.getBoundingClientRect();let s=i.width,a=i.height,r=0,o=0;if(this._carouselOptions.enableThumbnails){const e=this._carouselOptions.thumbnailHeight,t=this._carouselOptions.thumbnailPosition;"bottom"===t?a-=e:"top"===t?(a-=e,o=e):"left"===t?(s-=e,r=e):"right"===t&&(s-=e)}const l=i.left+r+s/2,c=i.top+o+a/2;this.process.currentImage={image:e,imageNode:t,animate:!1,factor:1,distanceFactor:1,scale:1,origin:{width:0,height:0,x:0,y:0,scale:1,min:.3,max:5},center:{x:l,y:c},minScale:.3,maxScale:5,x:0,y:0,width:()=>this.process.currentImage.imageNode.offsetWidth,height:()=>this.process.currentImage.imageNode.offsetHeight};const h=this._imageStates.get(n);if(h&&h.visited)this.setImageTransform(h.scale,h.x,h.y,!1);else{this.centerImageWithOptions(this.getCenterImageOptions());const e=this.getImageState();e&&this._imageStates.set(n,{scale:e.scale,x:e.x,y:e.y,visited:!0})}e.loaded&&e.evener&&e.evener.apply(),this.setupStateTracking(n)},0)}setupStateTracking(e){let t;const n=()=>{const t=this.process.currentImage;if(!t||t.image.index!==e)return;const n=this.getImageState();n&&this._imageStates.set(e,{scale:n.scale,x:n.x,y:n.y,visited:!0})},i=()=>{clearTimeout(t),t=setTimeout(n,300)},s=this._mainImageContainer,a=i,r=i,o=i;s.__stateTrackingCleanup&&s.__stateTrackingCleanup(),s.addEventListener("wheel",a,{passive:!0}),s.addEventListener("mouseup",r),s.addEventListener("touchend",o),s.__stateTrackingCleanup=()=>{clearTimeout(t),s.removeEventListener("wheel",a),s.removeEventListener("mouseup",r),s.removeEventListener("touchend",o)}}next(){if(this._carouselState.isTransitioning)return;const e=this.getNextIndex();e!==this._carouselState.currentIndex&&this.navigateTo(e,"forward")}previous(){if(this._carouselState.isTransitioning)return;const e=this.getPreviousIndex();e!==this._carouselState.currentIndex&&this.navigateTo(e,"backward")}goTo(e){if(this._carouselState.isTransitioning||e<0||e>=this._carouselState.totalImages||e===this._carouselState.currentIndex)return;const t=e>this._carouselState.currentIndex?"forward":"backward";this.navigateTo(e,t)}first(){this.goTo(0)}last(){this.goTo(this._carouselState.totalImages-1)}async navigateTo(e,t){const n=this._carouselState.currentIndex,i=this.process.images[e];let s=!1;const a={from:n,to:e,direction:t,image:i,instance:this,preventDefault:()=>{s=!0},stopPropagation:()=>{}};for(const o of this._navigateCallbacks)if(o(a),s)return;this._carouselState.currentIndex=e,this._carouselState.direction=t,await this.displayImage(e,!0),this.updateUIComponents();const r={index:e,image:i,total:this._carouselState.totalImages,instance:this};for(const o of this._slideChangeCallbacks)o(r);this._preloader&&this._preloader.preloadAdjacent(e)}updateUIComponents(){const e=this._carouselState.currentIndex;this._counter&&this._counter.update(e+1,this._carouselState.totalImages),this._thumbnailBar&&this._thumbnailBar.setActive(e),this._navigationArrows&&this._navigationArrows.updateDisabledState(e,this._carouselState.totalImages,this._carouselOptions.loop)}getNextIndex(){const e=this._carouselState.currentIndex;return e===this._carouselState.totalImages-1?this._carouselOptions.loop?0:e:e+1}getPreviousIndex(){const e=this._carouselState.currentIndex,t=this._carouselState.totalImages;return 0===e?this._carouselOptions.loop?t-1:e:e-1}play(){this._carouselState.isPlaying||(this._carouselState.isPlaying=!0,this._carouselState.playTimer=setInterval(()=>{this.next()},this._carouselOptions.autoPlayInterval))}pause(){this._carouselState.isPlaying&&(this._carouselState.isPlaying=!1,this._carouselState.playTimer&&(clearInterval(this._carouselState.playTimer),this._carouselState.playTimer=null))}togglePlay(){this._carouselState.isPlaying?this.pause():this.play()}getCurrentIndex(){return this._carouselState.currentIndex}getTotalImages(){return this._carouselState.totalImages}getImages(){return this.process.images}isPlaying(){return this._carouselState.isPlaying}onNavigate(e,t){if("function"==typeof e)if(t){const t=this._navigateCallbacks.indexOf(e);t>-1&&this._navigateCallbacks.splice(t,1)}else this._navigateCallbacks.push(e)}onSlideChange(e,t){if("function"==typeof e)if(t){const t=this._slideChangeCallbacks.indexOf(e);t>-1&&this._slideChangeCallbacks.splice(t,1)}else this._slideChangeCallbacks.push(e)}setupPauseOnHover(e){let t=!1;const n=()=>{this._carouselState.isPlaying?(t=!1,this.pause()):t=!0},i=()=>{!t&&this._carouselOptions.autoPlay&&this.play()};this._hoverHandlers={mouseenter:n,mouseleave:i},e.addEventListener("mouseenter",n),e.addEventListener("mouseleave",i)}cleanupPauseOnHover(){if(!this._hoverHandlers)return;const e=this.process.preview?.container;e&&(e.removeEventListener("mouseenter",this._hoverHandlers.mouseenter),e.removeEventListener("mouseleave",this._hoverHandlers.mouseleave)),this._hoverHandlers=null}close(){this.pause(),this._mainImageContainer&&this._mainImageContainer.__stateTrackingCleanup&&(this._mainImageContainer.__stateTrackingCleanup(),delete this._mainImageContainer.__stateTrackingCleanup),this._imageStates.clear(),this._thumbnailBar?.destroy(),this._thumbnailBar=void 0,this._keyboardNav?.destroy(),this._keyboardNav=void 0,this._swipeDetector?.destroy(),this._swipeDetector=void 0,this._navigationArrows?.destroy(),this._navigationArrows=void 0,this._counter?.destroy(),this._counter=void 0,this.cleanupClickHandlers(),this.cleanupPauseOnHover(),this._mainImageContainer&&(this._mainImageContainer.innerHTML=""),super.close()}cleanupClickHandlers(){this._clickHandlers.forEach((e,t)=>{t.removeEventListener("click",e)}),this._clickHandlers.clear(),this._originalEventHandlers.forEach((e,t)=>{e.evener&&e.evener.apply()}),this._originalEventHandlers.clear()}getContainerPreview(){const e=this,t=this.process;let n,i,s,a=!1,r=!1;function o(e){0===e.button&&(r=!0,t.flags.isMoved||(a=!1))}function l(e){(t.flags.isMoved||r)&&(a=!0)}function c(n){const i=t.context.body||t.context.getElementsByTagName("body")[0];if((this===n.target||!i)&&!a&&r)try{e.close()}catch(s){}a=!1,r=!1,n.stopPropagation(),n.preventDefault()}return t.container?(i=t.container,s=t.context):(i=t.context.createElement("DIV"),i.setAttribute("class","ZPhotoZoom"),n=t.context.body||t.context.getElementsByTagName("body")[0],s=i),{container:i,apply:function(){n&&n.appendChild(i)},evener:function(e){e?(s.removeEventListener("mousedown",o),s.removeEventListener("mousemove",l),s.removeEventListener("mouseup",c)):setTimeout(function(){s.addEventListener("mousedown",o),s.addEventListener("mousemove",l),s.addEventListener("mouseup",c)},100)}}}},e.zPhotoZoom=I,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}}),e}({});
//# sourceMappingURL=zphotozoom.js.map
