!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).zPhotoZoomLib={})}(this,function(e){"use strict";var t=Object.defineProperty,n=(e,n,o)=>((e,n,o)=>n in e?t(e,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[n]=o)(e,n+"",o);function o(e,t,n,o){const i=t.width/t.height;let s,a;if(e.landscape)s=8*t.width/10,a=s/e.prop,a>t.height&&(a=9*t.height/10,s=a*e.prop);else if(i>=e.prop)a=9*t.height/10,s=a*e.prop;else{const n=e.prop-i;a=9*t.height/10-8*t.height/10*n,s=a*e.prop}let r=Math.min(s/e.width,a/e.height);return"number"!=typeof n||n<=0?r<(n=.3)&&(n=r):r<n&&(r=n),"number"!=typeof o||o<n?r>(o=5)&&(o=r,r=3):r>o&&(r=o),{width:s,height:a,x:(t.width-s)/2,y:(t.height-a)/2,scale:r,min:n,max:o}}function i(){const e=this,t=this._process;let n=!1,o=!1;for(let s=0;s<t.eventsClose.length;s++){if(t.eventsClose[s]({preventDefault:()=>{n=!0},stopPropagation:()=>{o=!0},target:t.currentImage.image.node,instance:e}),n)return;if(o)break}t.flags={isAnimated:!1,isMoved:!1,wheel:!1,movements:0,updateAttempt:!1,updated:!1,zoomIn:!1,loader:!1,stoped:t.flags.stoped};try{t.currentImage.image.evener.remove()}catch(i){}if(t.container)t.preview.container.removeChild(t.currentImage.imageNode),t.preview.evener(!0);else{(t.context.body||t.context.getElementsByTagName("body")[0]).removeChild(t.preview.container)}t.flags.loader&&(clearTimeout(t.flags.loader),t.flags.loader=!1),t.preview=!1,t.loader=!1}function s(e,t){const n=this._process;n.container||(n.loader&&(n.preview.container.removeChild(n.loader),n.flags.loader&&(clearTimeout(n.flags.loader),n.flags.loader=!1)),e?(n.loader=n.context.createElement("SPAN"),n.loader.innerText=" "+e):n.loader=n.context.createElement("ZLOADER"),n.loader.style.opacity="1",n.preview.container.appendChild(n.loader),t&&a.call(this,t))}function a(e){const t=this._process;t.loader&&(t.flags.loader&&clearTimeout(t.flags.loader),t.loader.style.transition="opacity "+e+"ms",t.flags.loader=setTimeout(()=>{t.preview&&t.preview.container.removeChild(t.loader),t.loader=!1,t.flags.loader=!1},e))}function r(){const e=this,t=this._process;let n,o,s,a=!1,r=!1;function l(e){0===e.button&&(r=!0,t.flags.isMoved||(a=!1))}function c(e){(t.flags.isMoved||r)&&(a=!0)}function h(n){const o=t.context.body||t.context.getElementsByTagName("body")[0];if((this===n.target||!o)&&!a&&r)try{i.call(e)}catch(s){}a=!1,r=!1,n.stopPropagation(),n.preventDefault()}return t.container?(o=t.container,s=t.context):(o=t.context.createElement("DIV"),o.setAttribute("class","ZPhotoZoom"),n=t.context.body||t.context.getElementsByTagName("body")[0],s=o),{container:o,apply:function(){n&&n.appendChild(o)},evener:function(e){e?(s.removeEventListener("mousedown",l),s.removeEventListener("mousemove",c),s.removeEventListener("mouseup",h)):setTimeout(function(){s.addEventListener("mousedown",l),s.addEventListener("mousemove",c),s.addEventListener("mouseup",h)},100)}}}function l(e){const t=this,n=this._process;let i,a=!1,l=!1;for(let o=0;o<n.eventsOpen.length;o++){if(n.eventsOpen[o]({preventDefault:()=>{a=!0},stopPropagation:()=>{l=!0},target:e.node,instance:t}),a)return;if(l)break}let h={};n.preview=r.call(t),e.loaded?(i=e.imageNode,n.preview.container.appendChild(i),h=o(e,c.call(t).nf,n.scaleLimit.min,n.scaleLimit.max),f.call(t,h.scale,{x:h.x/h.scale,y:h.y/h.scale})):s.call(t),n.preview.apply(),n.preview.evener();const u=c.call(t).nf;n.currentImage={image:e,imageNode:i,animate:!1,factor:h.scale,distanceFactor:1,scale:h.scale,origin:h,center:{x:u.cx,y:u.cy},minScale:h.min,maxScale:h.max,x:h.x,y:h.y,width:function(){return n.currentImage.imageNode.offsetWidth},height:function(){return n.currentImage.imageNode.offsetHeight}},e.loaded&&e.evener.apply()}function c(){const e=this._process.container;if(e){const t=this._process.container.getBoundingClientRect();return{container:e,nf:{width:t.width,height:t.height,top:t.top,left:t.left,cx:t.left+t.width/2,cy:t.top+t.height/2,x:0,y:0}}}return{container:null,nf:{width:window.innerWidth,height:window.innerHeight,top:0,left:0,cx:window.innerWidth/2,cy:window.innerHeight/2,x:0,y:0}}}function h(e){const t=this,n=this._process;let o=0,i=null,s=!1,a=!1,r=null;function l(e){let o=0,i=0;const s=n.context.documentElement.scrollTop||n.context.body.scrollTop,a=n.context.documentElement.scrollLeft||n.context.body.scrollLeft,r=c.call(t).nf;o=r.top+s,i=r.left+a;const l=[];for(let t=0;t<e.length;t++)l.push({x:e[t].pageX-i,y:e[t].pageY-o});return l}function h(e){if(!a){const n=(new Date).getTime();return n-r<320&&(p.call(t,i[0]),m(),e.stopPropagation(),e.preventDefault()),n}return 0}function m(e){r=e||null,s=!1}function f(){i=null,a=!1}function b(e){if("mousedown"===e.type){const t=e;0===t.button&&(s=!0,i=l([t]),e.stopPropagation(),e.preventDefault())}else if("touchstart"===e.type){const t=e;s=!0,o=t.touches.length,i=l(t.touches)}}function v(e){if(!s&&!i){let n=1;e.deltaY<0&&(n=-1),d.call(t,l([e])[0],n),e.stopPropagation(),e.preventDefault()}}function y(e){if(s)if(0===e.button){a=!0;const n=l([e]);i&&u.call(t,i[0],n[0]),i=n,e.stopPropagation(),e.preventDefault()}else m(r),f()}function x(e){if(o>0)if(i)if(1===o){a=!0;const n=l(e.touches);u.call(t,i[0],n[0]),i=n,e.stopPropagation(),e.preventDefault()}else o>=2&&(i.length<2?i=l(e.touches):(g.call(t,i,l(e.touches)),e.stopPropagation(),e.preventDefault()));else i=l(e.touches)}function I(e){0===e.button&&(s&&(r=h(e)),m(r),f())}function w(e){s?(1===o&&(r=h(e),f(),n.currentImage.distanceFactor=1),o=e.touches.length,0===o?(m(),f(),n.flags.movements=0,n.currentImage.distanceFactor=1):f()):(n.flags.movements=0,n.currentImage.distanceFactor=1,m(),f())}return{remove:function(){e.removeEventListener("wheel",v,{passive:!1}),e.removeEventListener("mousedown",b,{passive:!1}),e.removeEventListener("touchstart",b,{passive:!1}),e.removeEventListener("mousemove",y),e.removeEventListener("touchmove",x,{passive:!1}),n.context.removeEventListener("mouseup",I,{passive:!1,capture:!0}),n.context.removeEventListener("touchend",w,{passive:!1,capture:!0})},apply:function(){o=0,i=null,s=!1,a=!1,r=null,e.addEventListener("wheel",v,{passive:!1}),e.addEventListener("mousedown",b,{passive:!1}),e.addEventListener("touchstart",b,{passive:!1}),e.addEventListener("mousemove",y),e.addEventListener("touchmove",x,{passive:!1}),n.context.addEventListener("mouseup",I,{passive:!1,capture:!0}),n.context.addEventListener("touchend",w,{passive:!1,capture:!0})}}}function u(e,t){const n=this._process;n.flags.movements||n.flags.isAnimated||(n.flags.isMoved=!0,n.currentImage.x+=t.x-e.x,n.currentImage.y+=t.y-e.y,f.call(this,n.currentImage.factor,{x:n.currentImage.x/n.currentImage.factor,y:n.currentImage.y/n.currentImage.factor},!1))}function d(e,t){const n=this._process;if(n.flags.updateAttempt||n.flags.stoped)return;t>0?n.currentImage.scale-=.05:n.currentImage.scale+=.05;const o=n.currentImage.factor;n.currentImage.scale=Math.min(n.currentImage.maxScale,Math.max(n.currentImage.scale,n.currentImage.minScale)),n.currentImage.factor=n.currentImage.scale;const i=n.currentImage.imageNode.getBoundingClientRect(),s=c.call(this).nf;n.currentImage.x-=(n.currentImage.factor/o-1)*(e.x-i.left+s.left),n.currentImage.y-=(n.currentImage.factor/o-1)*(e.y-i.top+s.top),f.call(this,n.currentImage.factor,{x:n.currentImage.x/n.currentImage.factor,y:n.currentImage.y/n.currentImage.factor}),n.currentImage.center=e,n.flags.wheel=setTimeout(function(){n.flags.wheel=!1},600)}function p(e){const t=this._process;if(!(t.flags.isAnimated||t.flags.updateAttempt||t.flags.stoped))if(t.currentImage.scale<=t.currentImage.origin.scale){const n=t.currentImage.factor,o=t.currentImage.imageNode.getBoundingClientRect(),i=c.call(this).nf;t.currentImage.scale=Math.min(t.currentImage.maxScale,Math.max(t.currentImage.scale+2,t.currentImage.minScale)),t.currentImage.factor=t.currentImage.scale,t.currentImage.x-=(t.currentImage.factor/n-1)*(e.x-o.left+i.left),t.currentImage.y-=(t.currentImage.factor/n-1)*(e.y-o.top+i.top),t.currentImage.center=e,f.call(this,t.currentImage.factor,{x:t.currentImage.x/t.currentImage.factor,y:t.currentImage.y/t.currentImage.factor},!0)}else m.call(this)}function m(){const e=this._process;e.currentImage.scale=e.currentImage.origin.scale,e.currentImage.factor=e.currentImage.origin.scale,e.currentImage.x=e.currentImage.origin.x,e.currentImage.y=e.currentImage.origin.y,e.currentImage.minScale=e.currentImage.origin.min,e.currentImage.maxScale=e.currentImage.origin.max;const t=c.call(this).nf;e.currentImage.center={x:t.cx,y:t.cy},f.call(this,e.currentImage.factor,{x:e.currentImage.x/e.currentImage.factor,y:e.currentImage.y/e.currentImage.factor},!0)}function g(e,t){const n=this,o=this._process;if(o.flags.updateAttempt||o.flags.stoped)return;const i=o.currentImage.distanceFactor;o.currentImage.distanceFactor=function(e,t){function n(e,t){const n=e.x-t.x,o=e.y-t.y;return Math.sqrt(n*n+o*o)}return n(t[0],t[1])/n(e[0],e[1])}(e,t);const s=o.currentImage.distanceFactor/i;s<1?o.flags.zoomIn||(o.flags.zoomIn=!0):o.flags.zoomIn&&(o.flags.zoomIn=!1),o.currentImage.scale*=s;const a=function(e){if(1===e.length)return{x:e[0].x,y:e[0].y};{const t=Array.prototype.slice.call(e).map(e=>({x:e.x,y:e.y}));return{x:t.map(e=>e.x).reduce((e,t)=>e+t)/t.length,y:t.map(e=>e.y).reduce((e,t)=>e+t)/t.length}}}(t),r=o.currentImage.factor;o.currentImage.factor=Math.min(o.currentImage.maxScale,Math.max(o.currentImage.scale,o.currentImage.minScale));const l=o.currentImage.imageNode.getBoundingClientRect();if(o.flags.movements&&o.flags.movements>1){const e=c.call(n).nf;o.currentImage.x-=(o.currentImage.factor/r-1)*(a.x-l.left+e.left)-(a.x-o.currentImage.center.x),o.currentImage.y-=(o.currentImage.factor/r-1)*(a.y-l.top+e.top)-(a.y-o.currentImage.center.y),o.flags.updated||o.flags.isAnimated||(o.flags.updated=!0,setTimeout(function(){f.call(n,o.currentImage.factor,{x:o.currentImage.x/o.currentImage.factor,y:o.currentImage.y/o.currentImage.factor}),o.flags.updated=!1},0))}o.currentImage.center=a,o.flags.movements+=1}function f(e,t,n){const o=this._process;if(o.flags.isAnimated)return;o.flags.isAnimated=!0;let i=Math.round(100*e);i<100&&(i=" "+i),s.call(this,i+"%",800),setTimeout(function(){o.flags.isAnimated=!1;const i="scale3d("+e+","+e+",1) translate3d("+t.x+"px,"+t.y+"px,0px)",s="scale("+e+", "+e+") translate("+t.x+"px,"+t.y+"px)";o.currentImage.animate&&clearTimeout(o.currentImage.animate),n?o.currentImage.animate=setTimeout(function(){o.currentImage.imageNode.style.transition="",o.currentImage.animate=!1,o.flags.isMoved=!1},500):(o.currentImage.imageNode.style.transition="",o.currentImage.animate=setTimeout(function(){o.flags.isMoved=!1},100)),o.currentImage.imageNode.style.transformOrigin="top left",o.currentImage.imageNode.style.webkitTransformOrigin="top left",o.currentImage.imageNode.style.transform=i,o.currentImage.imageNode.style.webkitTransform=i,o.currentImage.imageNode.style.mozTransform=s,o.currentImage.imageNode.style.msTransform=s,o.currentImage.imageNode.style.oTransform=s})}function b(){const e=this,t=this._process,n=t.selector,i=t.context;function s(n){!function(e,t){const n=new Image;n.onload=function(){const e=this.height,n=this.width;t.call(this,n,e)},n.src=e}(n.src,function(i,s){n.imageNode=this,n.loaded=!0,n.width=i,n.height=s,n.prop=i/s,n.landscape=i>=s,n.evener=h.call(e,this),t.preview&&t.currentImage.image===n&&(t.currentImage.imageNode=this,t.preview.container.appendChild(t.currentImage.imageNode),t.currentImage.origin=o(n,c.call(e).nf,t.scaleLimit.min,t.scaleLimit.max),a.call(e,480),m.call(e),n.evener.apply())})}const r=[];let l=[];if(n&&"string"==typeof n&&i&&Node.DOCUMENT_NODE===i.nodeType)if(/\s+[^#]|>|\[|\.|,/.test(n))l=Array.from(i.querySelectorAll(n));else{const e=i.querySelector(n);e&&(l=[e])}if((Array.isArray(l)||l instanceof NodeList)&&l.length>0)for(let o=0;o<l.length;o++){const e=l[o],t={node:e,src:""};let n=!1;if("IMG"===e.tagName&&e.src)n=e.src;else{const t=getComputedStyle(e).backgroundImage;if(t)if(/^url\(/.test(t))try{const e=t.match(/url\(["']?([^"']*)["']?\)/);n=!!e&&e[1]}catch(u){n=!1}else n=!1}n&&(t.src=n,s(t),r.push(t))}return r}function v(e,t){const n=this;let o=!1,i=!1;function s(t){i||l.call(n,e),i=!1,o=!1}function a(){o=!0}function r(){o&&(i=!0)}t?(e.node.removeEventListener("click",s),e.node.removeEventListener("touchstart",a),e.node.removeEventListener("touchend",s),e.node.removeEventListener("touchmove",r)):(e.node.addEventListener("click",s),e.node.addEventListener("touchstart",a),e.node.addEventListener("touchend",s),e.node.addEventListener("touchmove",r))}function y(){const e=this._process;if(e.images=b.call(this),e.images.length>0)for(let t=0;t<e.images.length;t++)v.call(this,e.images[t])}function x(e,t){Object.defineProperty(this,"_process",{value:{preview:null,loader:null,eventsOpen:[],eventsClose:[],images:[],flags:{isAnimated:!1,isMoved:!1,wheel:!1,movements:0,updateAttempt:!1,updated:!1,zoomIn:!1,loader:!1,stoped:!1},container:e.container,scaleLimit:{min:e.min,max:e.max},selector:e.el,context:t||document,currentImage:null},configurable:!1,enumerable:!1,writable:!1})}function I(){const e=this,t=e._process;y.call(e),window.addEventListener("resize",function(){if(t.preview){const n=o(t.currentImage.image,c.call(e).nf,t.scaleLimit.min,t.scaleLimit.max);t.currentImage.origin=n,function n(){t.flags.updateAttempt=setTimeout(function(){t.flags.isAnimated?n():(m.call(e),t.flags.updateAttempt=!1)},70)}()}})}class w{constructor(e,t){if(n(this,"_process"),(()=>{if(document.getElementById("z-photo-zoom-styles"))return;const e=document.createElement("style");e.id="z-photo-zoom-styles",e.textContent="\n    .ZPhotoZoom {\n      position: fixed;\n      left: 0;\n      top: 0;\n      width: 100vw;\n      height: 100vh;\n      background-color: rgba(0, 0, 0, 0.7);\n      z-index: 999999999;\n      -webkit-user-select: none;\n      -moz-user-select: none;\n      -ms-user-select: none;\n      user-select: none;\n    }\n\n    .ZPhotoZoom img {\n      position: absolute;\n      cursor: grab;\n    }\n\n    .ZPhotoZoom img:active {\n      cursor: grabbing;\n    }\n\n    .ZPhotoZoom span {\n      color: white;\n      line-height: 30px;\n      font-weight: bold;\n      position: fixed;\n      top: calc(50vh - 25px);\n      left: calc(50vw - 15px);\n      background-color: rgba(114, 123, 135, 0.5);\n      width: 50px;\n      height: 30px;\n      display: inline-block;\n      vertical-align: middle;\n      border-radius: 5px;\n      text-align: center;\n    }\n\n    .ZPhotoZoom zloader {\n      position: fixed;\n      top: calc(50vh - 50px);\n      left: calc(50vw - 50px);\n      width: 40px;\n      height: 40px;\n      display: inline-block;\n      vertical-align: middle;\n      border-radius: 40px;\n      border: 6px solid rgba(114, 123, 135, 0.4);\n    }\n\n    .ZPhotoZoom zloader:after {\n      content: '';\n      position: absolute;\n      top: -6px;\n      left: -6px;\n      bottom: -6px;\n      right: -6px;\n      width: 40px;\n      height: 40px;\n      border-radius: 40px;\n      border: 6px solid transparent;\n      border-top-color: rgba(38, 38, 38, 0.27);\n      -webkit-animation: zPhotoZoomSpin 1s linear infinite;\n      animation: zPhotoZoomSpin 1s linear infinite;\n    }\n\n    @keyframes zPhotoZoomSpin {\n      0% {\n        -webkit-transform: rotate(0deg);\n        transform: rotate(0deg);\n      }\n      100% {\n        -webkit-transform: rotate(360deg);\n        transform: rotate(360deg);\n      }\n    }\n  ",document.head.appendChild(e)})(),!(this instanceof w))return console.error("zPhotoZoom is a class and can only be called with the keyword 'new'");e&&("object"==typeof e&&x.call(this,e,t),"string"==typeof e.el&&I.call(this))}stop(){this._process.flags.stoped=!0}resume(){this._process.flags.stoped=!1}reset(){this._process.preview&&m.call(this)}close(){this._process.preview&&i.call(this)}update(){const e=this._process;e.preview&&f.call(this,e.currentImage.factor,{x:e.currentImage.x/e.currentImage.factor,y:e.currentImage.y/e.currentImage.factor})}change(e){const t=this._process;if("string"==typeof e){t.preview&&i.call(this);for(let e=0;e<t.images.length;e++)v.call(this,t.images[e],!0);t.selector=e,t.images=[],y.call(this)}}onOpen(e,t){const n=this._process;if("function"==typeof e)if(t)for(let o=n.eventsOpen.length-1;o>=0;o--)n.eventsOpen[o]===e&&n.eventsOpen.splice(o,1);else n.eventsOpen.push(e)}onClose(e,t){const n=this._process;if("function"==typeof e)if(t)for(let o=n.eventsClose.length-1;o>=0;o--)n.eventsClose[o]===e&&n.eventsClose.splice(o,1);else n.eventsClose.push(e)}}var _=Object.defineProperty,z=(e,t,n)=>((e,t,n)=>t in e?_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);const C={ArrowLeft:"previous",ArrowRight:"next",Escape:"close",Home:"first",End:"last",Space:"togglePlay"};class E{constructor(e){z(this,"options"),z(this,"enabled"),z(this,"boundHandler",null),this.options=e,this.enabled=e.enabled,this.enabled&&this.enable()}enable(){this.enabled&&this.boundHandler||(this.enabled=!0,this.boundHandler=this.handleKeyDown.bind(this),document.addEventListener("keydown",this.boundHandler))}disable(){this.enabled&&this.boundHandler&&(this.enabled=!1,document.removeEventListener("keydown",this.boundHandler),this.boundHandler=null)}destroy(){this.disable()}handleKeyDown(e){if(!this.enabled)return;const t=e.target;if(["INPUT","TEXTAREA","SELECT","BUTTON"].includes(t.tagName)||t.isContentEditable||t.closest('[contenteditable="true"]'))return;const n=C[e.key];if(n)switch(e.preventDefault(),e.stopPropagation(),n){case"next":this.options.onNext();break;case"previous":this.options.onPrevious();break;case"close":this.options.onClose();break;case"first":this.options.onFirst();break;case"last":this.options.onLast();break;case"togglePlay":this.options.onTogglePlay&&this.options.onTogglePlay()}}}var T=Object.defineProperty,P=(e,t,n)=>((e,t,n)=>t in e?T(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);class S{constructor(e){if(P(this,"options"),P(this,"images"),P(this,"loadingQueue",new Set),P(this,"loadedIndices",new Set),this.options=e,this.images=e.images||[],!Array.isArray(this.images))return console.error("zPhotoCarousel: Preloader requires an array of images"),void(this.images=[]);this.options.preloadAll&&this.images.length>0&&this.preloadAll().catch(e=>{console.warn("zPhotoCarousel: Error preloading all images:",e)})}async preloadImage(e){if(e<0||e>=this.images.length)return Promise.reject(new Error(`Invalid index: ${e}`));const t=this.images[e];return t?t.loaded||this.loadedIndices.has(e)?Promise.resolve():this.loadingQueue.has(e)?this.waitForLoad(e):(this.loadingQueue.add(e),new Promise(n=>{const o=new Image;o.onload=()=>{t.imageNode=o,t.loaded=!0,t.width=o.naturalWidth,t.height=o.naturalHeight,t.prop=o.naturalWidth/o.naturalHeight,t.landscape=o.naturalWidth>=o.naturalHeight,this.loadedIndices.add(e),this.loadingQueue.delete(e),n()},o.onerror=()=>{console.warn(`zPhotoCarousel: Failed to load image at index ${e}:`,t.src),t.imageNode=o,t.loaded=!0,t.failed=!0,this.loadedIndices.add(e),this.loadingQueue.delete(e),n()},o.src=t.src})):Promise.reject(new Error(`Image data not found at index: ${e}`))}async preloadAdjacent(e){if(!this.options.preloadAdjacent)return Promise.resolve();const t=this.images.length;if(0===t||e<0||e>=t)return Promise.resolve();const n=[],o=(e+1)%t,i=this.images[o];!i||i.loaded||this.loadedIndices.has(o)||n.push(o);const s=0===e?t-1:e-1,a=this.images[s];!a||a.loaded||this.loadedIndices.has(s)||n.push(s);try{await Promise.all(n.map(e=>this.preloadImage(e)))}catch(r){console.warn("zPhotoCarousel: Some adjacent images failed to preload",r)}}async preloadAll(){if(!this.options.preloadAll)return Promise.resolve();const e=[];for(let n=0;n<this.images.length;n++){const t=this.images[n];!t||t.loaded||this.loadedIndices.has(n)||e.push(n)}for(let n=0;n<e.length;n+=3){const o=e.slice(n,n+3);try{await Promise.all(o.map(e=>this.preloadImage(e)))}catch(t){console.warn("zPhotoCarousel: Some images failed to preload in batch",t)}}}waitForLoad(e){return new Promise(t=>{let n;const o=setInterval(()=>{this.loadingQueue.has(e)||(clearInterval(o),clearTimeout(n),t())},50);n=setTimeout(()=>{clearInterval(o),console.warn(`zPhotoCarousel: Preload timeout for image at index ${e}`),t()},1e4)})}getStats(){const e=this.images.length,t=this.loadedIndices.size;return{loaded:t,total:e,percentage:e>0?Math.round(t/e*100):0}}}var k=Object.defineProperty,A=(e,t,n)=>((e,t,n)=>t in e?k(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);class L{constructor(e){A(this,"options"),A(this,"element"),A(this,"startPoint",null),A(this,"enabled",!0),A(this,"boundTouchStart",null),A(this,"boundTouchMove",null),A(this,"boundTouchEnd",null),this.options=e,this.element=e.element,this.enable()}enable(){this.boundTouchStart||(this.enabled=!0,this.boundTouchStart=this.handleTouchStart.bind(this),this.boundTouchMove=this.handleTouchMove.bind(this),this.boundTouchEnd=this.handleTouchEnd.bind(this),this.element.addEventListener("touchstart",this.boundTouchStart,{passive:!1}),this.element.addEventListener("touchmove",this.boundTouchMove,{passive:!1}),this.element.addEventListener("touchend",this.boundTouchEnd,{passive:!1}))}disable(){this.boundTouchStart&&(this.enabled=!1,this.element.removeEventListener("touchstart",this.boundTouchStart),this.element.removeEventListener("touchmove",this.boundTouchMove),this.element.removeEventListener("touchend",this.boundTouchEnd),this.boundTouchStart=null,this.boundTouchMove=null,this.boundTouchEnd=null)}destroy(){this.disable()}handleTouchStart(e){if(this.enabled&&this.options.isEnabled())if(1===e.touches.length){const t=e.touches[0];t&&(this.startPoint={x:t.clientX,y:t.clientY,time:Date.now()})}else this.startPoint=null}handleTouchMove(e){this.enabled&&this.startPoint&&this.options.isEnabled()&&e.touches.length>1&&(this.startPoint=null)}handleTouchEnd(e){if(!this.enabled||!this.startPoint||!this.options.isEnabled())return void(this.startPoint=null);const t=e.changedTouches[0];if(!t)return void(this.startPoint=null);const n={x:t.clientX,y:t.clientY,time:Date.now()};this.detectSwipe(this.startPoint,n),this.startPoint=null}detectSwipe(e,t){const n=t.x-e.x,o=t.y-e.y,i=t.time-e.time,s=Math.abs(n);s<=Math.abs(o)||s<this.options.threshold||i>300||(n>0?this.options.onSwipeRight():this.options.onSwipeLeft())}}var N=Object.defineProperty,O=(e,t,n)=>((e,t,n)=>t in e?N(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);class H{constructor(e){O(this,"options"),O(this,"container",null),O(this,"track",null),O(this,"thumbnails",[]),O(this,"currentIndex"),this.options=e,this.currentIndex=e.currentIndex}render(){this.container=document.createElement("div"),this.container.className=`zpz-thumbnail-bar zpz-tb-${this.options.position}`,this.container.style.height=`${this.options.height}px`;const e=document.createElement("div");return e.className="zpz-tb-container",this.container.appendChild(e),this.track=document.createElement("div"),this.track.className="zpz-tb-track",e.appendChild(this.track),this.options.images.forEach((e,t)=>{const n=this.createThumbnail(e,t);this.thumbnails.push(n),this.track.appendChild(n)}),this.setActive(this.currentIndex),this.container}createThumbnail(e,t){const n=document.createElement("div");n.className="zpz-tb-item",n.setAttribute("data-index",t.toString()),n.setAttribute("role","button"),n.setAttribute("tabindex","0"),n.setAttribute("aria-label",`View image ${t+1}`);const o="top"===this.options.position||"bottom"===this.options.position,i=o?this.options.height-20:this.options.height;o?n.style.width=`${i}px`:n.style.height=`${i}px`;const s=document.createElement("img");return s.src=e.thumbnailSrc||e.src,s.alt=`Thumbnail ${t+1}`,s.draggable=!1,s.style.pointerEvents="none",n.appendChild(s),n.addEventListener("click",()=>{this.options.onThumbnailClick(t)}),n.addEventListener("keydown",e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),this.options.onThumbnailClick(t))}),n}setActive(e){if(e<0||e>=this.thumbnails.length)return;if(this.currentIndex>=0&&this.currentIndex<this.thumbnails.length){const e=this.thumbnails[this.currentIndex];e&&(e.classList.remove("zpz-tb-active"),e.setAttribute("aria-selected","false"))}const t=this.thumbnails[e];t&&(t.classList.add("zpz-tb-active"),t.setAttribute("aria-selected","true")),this.currentIndex=e,this.scrollToActive()}scrollToActive(){if(!this.track||!this.container||this.currentIndex<0)return;const e=this.thumbnails[this.currentIndex];e&&e.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"})}update(e){this.track&&(this.track.innerHTML="",this.thumbnails=[],e.forEach((e,t)=>{const n=this.createThumbnail(e,t);this.thumbnails.push(n),this.track.appendChild(n)}),this.setActive(0))}destroy(){this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container),this.container=null,this.track=null,this.thumbnails=[]}}var M=Object.defineProperty,B=(e,t,n)=>((e,t,n)=>t in e?M(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);class D{constructor(e,t,n="center"){this.onPrevious=e,this.onNext=t,this.position=n,B(this,"container",null),B(this,"prevButton",null),B(this,"nextButton",null)}render(){return this.container=document.createElement("div"),this.container.className=`zpz-nav-arrows zpz-arrows-${this.position}`,this.prevButton=this.createArrowButton("prev",this.onPrevious),this.container.appendChild(this.prevButton),this.nextButton=this.createArrowButton("next",this.onNext),this.container.appendChild(this.nextButton),this.container}createArrowButton(e,t){const n=document.createElement("button");n.className=`zpz-arrow zpz-arrow-${e}`,n.setAttribute("aria-label","prev"===e?"Previous image":"Next image"),n.type="button";const o=this.createArrowIcon(e);return n.appendChild(o),n.addEventListener("click",e=>{e.stopPropagation(),t()}),n}createArrowIcon(e){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("width","24"),t.setAttribute("height","24"),t.setAttribute("viewBox","0 0 24 24"),t.setAttribute("fill","none"),t.setAttribute("stroke","currentColor"),t.setAttribute("stroke-width","2"),t.setAttribute("stroke-linecap","round"),t.setAttribute("stroke-linejoin","round");const n=document.createElementNS("http://www.w3.org/2000/svg","path");return"prev"===e?n.setAttribute("d","M15 18l-6-6 6-6"):n.setAttribute("d","M9 18l6-6-6-6"),t.appendChild(n),t}updateDisabledState(e,t,n){this.prevButton&&this.nextButton&&(n?(this.prevButton.disabled=!1,this.nextButton.disabled=!1):(this.prevButton.disabled=0===e,this.nextButton.disabled=e===t-1))}destroy(){this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container),this.container=null,this.prevButton=null,this.nextButton=null}}var j=Object.defineProperty,$=(e,t,n)=>((e,t,n)=>t in e?j(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);class Z{constructor(e="top-right"){this.position=e,$(this,"container",null),$(this,"currentSpan",null),$(this,"totalSpan",null)}render(){this.container=document.createElement("div"),this.container.className=`zpz-counter zpz-counter-${this.position}`,this.container.setAttribute("aria-live","polite"),this.container.setAttribute("aria-atomic","true"),this.currentSpan=document.createElement("span"),this.currentSpan.className="zpz-counter-current",this.currentSpan.textContent="1";const e=document.createElement("span");return e.className="zpz-counter-separator",e.textContent="/",this.totalSpan=document.createElement("span"),this.totalSpan.className="zpz-counter-total",this.totalSpan.textContent="1",this.container.appendChild(this.currentSpan),this.container.appendChild(e),this.container.appendChild(this.totalSpan),this.container}update(e,t){this.currentSpan&&this.totalSpan&&(this.currentSpan.textContent=e.toString(),this.totalSpan.textContent=t.toString(),this.container&&this.container.setAttribute("aria-label",`Image ${e} of ${t}`))}destroy(){this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container),this.container=null,this.currentSpan=null,this.totalSpan=null}}const F=async(e,t,n,o,i)=>new Promise((s,a)=>{if(e&&t&&i){!i.contains(e)&&e.parentNode&&console.warn("zPhotoCarousel: fromElement is not in the expected container");try{const a="forward"===n?"100%":"-100%",r="forward"===n?"-100%":"100%";t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="100%",t.style.transform=`translateX(${a})`,t.style.opacity="1",t.parentNode!==i&&i.appendChild(t),t.offsetHeight;const l="cubic-bezier(0.4, 0, 0.2, 1)";e.style.transition=`transform ${o}ms ${l}`,t.style.transition=`transform ${o}ms ${l}`,e.style.transform=`translateX(${r})`,t.style.transform="translateX(0)";const c=setTimeout(()=>{try{e.parentNode===i&&i.removeChild(e),e.style.transform="",e.style.transition="",e.style.position="",t.style.transition="",t.style.position="",s()}catch(n){console.error("zPhotoCarousel: Error during transition cleanup:",n),s()}},o);t.__transitionTimeoutId=c}catch(r){console.error("zPhotoCarousel: Error during slide transition:",r),a(r)}}else a(new Error("Transition requires valid fromElement, toElement, and container"))}),R={slide:F,fade:async(e,t,n,o,i)=>new Promise((n,s)=>{if(e&&t&&i){!i.contains(e)&&e.parentNode&&console.warn("zPhotoCarousel: fromElement is not in the expected container");try{t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="100%",t.style.opacity="0",t.parentNode!==i&&i.appendChild(t),t.offsetHeight,e.style.transition=`opacity ${o}ms ease`,t.style.transition=`opacity ${o}ms ease`,e.style.opacity="0",t.style.opacity="1";const s=setTimeout(()=>{try{e.parentNode===i&&i.removeChild(e),e.style.opacity="",e.style.transition="",e.style.position="",t.style.transition="",t.style.position="",n()}catch(o){console.error("zPhotoCarousel: Error during transition cleanup:",o),n()}},o);t.__transitionTimeoutId=s}catch(a){console.error("zPhotoCarousel: Error during fade transition:",a),s(a)}}else s(new Error("Transition requires valid fromElement, toElement, and container"))}),none:async(e,t,n,o,i)=>new Promise((n,o)=>{if(e&&t&&i)try{t.parentNode!==i&&i.appendChild(t),e.parentNode===i&&i.removeChild(e),n()}catch(s){console.error("zPhotoCarousel: Error during instant transition:",s),o(s)}else o(new Error("Transition requires valid fromElement, toElement, and container"))})};var V=Object.defineProperty,W=(e,t,n)=>((e,t,n)=>t in e?V(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);e.default=w,e.zPhotoCarousel=class extends w{constructor(e,t){(()=>{if(document.getElementById("z-photo-carousel-styles"))return;const e=document.createElement("style");e.id="z-photo-carousel-styles",e.textContent="\n    /* Carousel main container modifications */\n    .ZPhotoZoom.zpz-carousel-mode {\n      display: flex;\n      flex-direction: column;\n    }\n\n    .zpz-main-image-container {\n      position: relative;\n      flex: 1;\n      overflow: hidden;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n    }\n\n    .zpz-main-image-container img {\n      position: absolute;\n      max-width: 100%;\n      max-height: 100%;\n    }\n\n    /* Navigation Arrows */\n    .zpz-nav-arrows {\n      position: absolute;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      pointer-events: none;\n      z-index: 999;\n    }\n\n    .zpz-arrow {\n      pointer-events: auto;\n      position: absolute;\n      top: 50%;\n      transform: translateY(-50%);\n      background: rgba(0, 0, 0, 0.5);\n      backdrop-filter: blur(10px);\n      border: 2px solid rgba(255, 255, 255, 0.2);\n      width: 50px;\n      height: 50px;\n      border-radius: 50%;\n      cursor: pointer;\n      transition: all 0.3s ease;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      color: white;\n      outline: none;\n    }\n\n    .zpz-arrow:hover:not(:disabled) {\n      background: rgba(102, 126, 234, 0.8);\n      border-color: rgba(102, 126, 234, 1);\n      transform: translateY(-50%) scale(1.1);\n    }\n\n    .zpz-arrow:active:not(:disabled) {\n      transform: translateY(-50%) scale(0.95);\n    }\n\n    .zpz-arrow:disabled {\n      opacity: 0.3;\n      cursor: not-allowed;\n    }\n\n    .zpz-arrow:focus-visible {\n      outline: 2px solid #667eea;\n      outline-offset: 2px;\n    }\n\n    .zpz-arrow-prev {\n      left: 20px;\n    }\n\n    .zpz-arrow-next {\n      right: 20px;\n    }\n\n    .zpz-arrow svg {\n      width: 24px;\n      height: 24px;\n      fill: none;\n    }\n\n    /* Counter */\n    .zpz-counter {\n      position: absolute;\n      background: rgba(0, 0, 0, 0.7);\n      backdrop-filter: blur(10px);\n      padding: 8px 16px;\n      border-radius: 20px;\n      color: white;\n      font-size: 16px;\n      font-weight: 500;\n      z-index: 1000;\n      user-select: none;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n    }\n\n    .zpz-counter-top-left {\n      top: 20px;\n      left: 20px;\n    }\n\n    .zpz-counter-top-right {\n      top: 20px;\n      right: 20px;\n    }\n\n    .zpz-counter-bottom-left {\n      bottom: 20px;\n      left: 20px;\n    }\n\n    .zpz-counter-bottom-right {\n      bottom: 20px;\n      right: 20px;\n    }\n\n    .zpz-counter-separator {\n      margin: 0 8px;\n      opacity: 0.6;\n    }\n\n    /* Thumbnail Bar */\n    .zpz-thumbnail-bar {\n      position: absolute;\n      background: linear-gradient(180deg, rgba(0, 0, 0, 0.95) 0%, rgba(0, 0, 0, 0.85) 100%);\n      backdrop-filter: blur(20px);\n      z-index: 1000;\n      border-top: 1px solid rgba(255, 255, 255, 0.1);\n    }\n\n    .zpz-tb-bottom {\n      bottom: 0;\n      left: 0;\n      right: 0;\n    }\n\n    .zpz-tb-top {\n      top: 0;\n      left: 0;\n      right: 0;\n      border-top: none;\n      border-bottom: 1px solid rgba(255, 255, 255, 0.1);\n    }\n\n    .zpz-tb-left {\n      left: 0;\n      top: 0;\n      bottom: 0;\n      border-top: none;\n      border-right: 1px solid rgba(255, 255, 255, 0.1);\n    }\n\n    .zpz-tb-right {\n      right: 0;\n      top: 0;\n      bottom: 0;\n      border-top: none;\n      border-left: 1px solid rgba(255, 255, 255, 0.1);\n    }\n\n    .zpz-tb-container {\n      width: 100%;\n      height: 100%;\n      overflow-x: auto;\n      overflow-y: hidden;\n      padding: 12px 16px;\n      scroll-behavior: smooth;\n      -webkit-overflow-scrolling: touch;\n    }\n\n    .zpz-tb-left .zpz-tb-container,\n    .zpz-tb-right .zpz-tb-container {\n      overflow-x: hidden;\n      overflow-y: auto;\n    }\n\n    /* Custom scrollbar for webkit browsers */\n    .zpz-tb-container::-webkit-scrollbar {\n      height: 6px;\n      width: 6px;\n    }\n\n    .zpz-tb-container::-webkit-scrollbar-track {\n      background: rgba(255, 255, 255, 0.05);\n      border-radius: 3px;\n    }\n\n    .zpz-tb-container::-webkit-scrollbar-thumb {\n      background: rgba(255, 255, 255, 0.2);\n      border-radius: 3px;\n    }\n\n    .zpz-tb-container::-webkit-scrollbar-thumb:hover {\n      background: rgba(255, 255, 255, 0.3);\n    }\n\n    .zpz-tb-track {\n      display: flex;\n      gap: 12px;\n      height: 100%;\n      justify-content: center;\n      align-items: center;\n      min-width: min-content;\n    }\n\n    .zpz-tb-bottom .zpz-tb-track,\n    .zpz-tb-top .zpz-tb-track {\n      flex-direction: row;\n    }\n\n    .zpz-tb-left .zpz-tb-track,\n    .zpz-tb-right .zpz-tb-track {\n      flex-direction: column;\n    }\n\n    .zpz-tb-item {\n      flex: 0 0 auto;\n      cursor: pointer;\n      border: 2px solid rgba(255, 255, 255, 0.15);\n      border-radius: 8px;\n      overflow: hidden;\n      transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);\n      background: rgba(255, 255, 255, 0.05);\n      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);\n      position: relative;\n    }\n\n    .zpz-tb-item::after {\n      content: '';\n      position: absolute;\n      inset: 0;\n      background: linear-gradient(180deg, transparent 0%, rgba(0, 0, 0, 0.2) 100%);\n      opacity: 0;\n      transition: opacity 0.25s ease;\n    }\n\n    .zpz-tb-item:hover {\n      border-color: rgba(255, 255, 255, 0.4);\n      transform: translateY(-4px) scale(1.05);\n      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.5);\n    }\n\n    .zpz-tb-item:hover::after {\n      opacity: 1;\n    }\n\n    .zpz-tb-item:focus-visible {\n      outline: 3px solid #667eea;\n      outline-offset: 3px;\n    }\n\n    .zpz-tb-item.zpz-tb-active {\n      border-color: #667eea;\n      border-width: 3px;\n      box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2),\n                  0 4px 20px rgba(102, 126, 234, 0.6);\n      transform: scale(1.1);\n    }\n\n    .zpz-tb-item.zpz-tb-active::after {\n      opacity: 0;\n    }\n\n    .zpz-tb-item img {\n      width: 100%;\n      height: 100%;\n      object-fit: cover;\n      display: block;\n    }\n\n    /* Mobile responsive */\n    @media (max-width: 768px) {\n      .zpz-tb-bottom,\n      .zpz-tb-top {\n        height: 80px !important;\n      }\n\n      .zpz-arrow {\n        width: 40px;\n        height: 40px;\n      }\n\n      .zpz-arrow svg {\n        width: 20px;\n        height: 20px;\n      }\n\n      .zpz-arrow-prev {\n        left: 10px;\n      }\n\n      .zpz-arrow-next {\n        right: 10px;\n      }\n\n      .zpz-counter {\n        font-size: 14px;\n        padding: 6px 12px;\n      }\n    }\n  ",document.head.appendChild(e)})(),super(e,t),W(this,"_carouselState"),W(this,"_carouselOptions"),W(this,"_thumbnailBar"),W(this,"_keyboardNav"),W(this,"_preloader"),W(this,"_swipeDetector"),W(this,"_navigationArrows"),W(this,"_counter"),W(this,"_navigateCallbacks",[]),W(this,"_slideChangeCallbacks",[]),W(this,"_mainImageContainer"),W(this,"_clickHandlers",new Map),W(this,"_hoverHandlers",null),W(this,"_activeTransitionController",null),W(this,"_originalEventHandlers",new Map),W(this,"_imageStates",new Map),this._carouselOptions={...e,carousel:!1!==e.carousel,loop:!1!==e.loop,startIndex:e.startIndex||0,enableThumbnails:!1!==e.enableThumbnails,thumbnailHeight:e.thumbnailHeight||120,thumbnailPosition:e.thumbnailPosition||"bottom",thumbnailsVisible:e.thumbnailsVisible||5,enableKeyboard:!1!==e.enableKeyboard,enableArrows:!1!==e.enableArrows,arrowPosition:e.arrowPosition||"center",enableSwipe:!1!==e.enableSwipe,transition:e.transition||"slide",transitionDuration:e.transitionDuration||400,autoPlay:e.autoPlay||!1,autoPlayInterval:e.autoPlayInterval||3e3,pauseOnHover:!1!==e.pauseOnHover,preloadAdjacent:!1!==e.preloadAdjacent,preloadAll:e.preloadAll||!1,showCounter:!1!==e.showCounter,counterPosition:e.counterPosition||"top-right"},this._carouselState={currentIndex:this._carouselOptions.startIndex,totalImages:this.process.images.length,isPlaying:!1,playTimer:null,isTransitioning:!1,direction:null},this.initializeCarousel()}get process(){return this._process}initializeCarousel(){this._carouselOptions.carousel&&(this.process.images.forEach((e,t)=>{e.index=t}),(this._carouselOptions.preloadAdjacent||this._carouselOptions.preloadAll)&&(this._preloader=new S({images:this.process.images,preloadAdjacent:this._carouselOptions.preloadAdjacent,preloadAll:this._carouselOptions.preloadAll})),this.process.images.forEach((e,t)=>{e.evener&&(this._originalEventHandlers.set(e.node,{evener:e.evener}),e.evener.remove());const n=this._clickHandlers.get(e.node);n&&e.node.removeEventListener("click",n);const o=e=>{e.preventDefault(),e.stopPropagation(),this.openCarouselAt(t)};this._clickHandlers.set(e.node,o),e.node.addEventListener("click",o)}))}openCarouselAt(e){this._carouselState.currentIndex=e;const t=this.process.images[e];this.openCarouselViewer(t)}openCarouselViewer(e){let t=!1;for(let n=0;n<this.process.eventsOpen.length;n++){const o={preventDefault:()=>{t=!0},stopPropagation:()=>{},target:e.node,instance:this};if(this.process.eventsOpen[n](o),t)return}this.createCarouselStructure(),this.setupCarouselComponents(),this.displayImage(this._carouselState.currentIndex,!1),this._preloader&&this._preloader.preloadAdjacent(this._carouselState.currentIndex),this._carouselOptions.autoPlay&&this.play()}createCarouselStructure(){if(!this.process.preview){const e=this.getContainerPreview();this.process.preview=e,this.process.preview.apply(),this.process.preview.evener()}const e=this.process.preview.container;e.classList.add("zpz-carousel-mode"),this._mainImageContainer&&this._mainImageContainer.parentNode?this._mainImageContainer.innerHTML="":(this._mainImageContainer=document.createElement("div"),this._mainImageContainer.className="zpz-main-image-container",e.appendChild(this._mainImageContainer))}setupCarouselComponents(){const e=this.process.preview.container;this._carouselOptions.enableArrows&&(this._navigationArrows=new D(()=>this.previous(),()=>this.next(),this._carouselOptions.arrowPosition),this._mainImageContainer.appendChild(this._navigationArrows.render()),this._navigationArrows.updateDisabledState(this._carouselState.currentIndex,this._carouselState.totalImages,this._carouselOptions.loop)),this._carouselOptions.showCounter&&(this._counter=new Z(this._carouselOptions.counterPosition),this._mainImageContainer.appendChild(this._counter.render()),this._counter.update(this._carouselState.currentIndex+1,this._carouselState.totalImages)),this._carouselOptions.enableThumbnails&&(this._thumbnailBar=new H({images:this.process.images,position:this._carouselOptions.thumbnailPosition,height:this._carouselOptions.thumbnailHeight,visibleCount:this._carouselOptions.thumbnailsVisible,currentIndex:this._carouselState.currentIndex,onThumbnailClick:e=>this.goTo(e)}),e.appendChild(this._thumbnailBar.render())),this._carouselOptions.enableKeyboard&&(this._keyboardNav=new E({onNext:()=>this.next(),onPrevious:()=>this.previous(),onClose:()=>this.close(),onFirst:()=>this.first(),onLast:()=>this.last(),onTogglePlay:()=>this.togglePlay(),enabled:!0})),this._carouselOptions.enableSwipe&&this._mainImageContainer&&(this._swipeDetector=new L({element:this._mainImageContainer,threshold:50,onSwipeLeft:()=>this.next(),onSwipeRight:()=>this.previous(),isEnabled:()=>this.process.currentImage?.scale===this.process.currentImage?.origin.scale})),this._carouselOptions.pauseOnHover&&this._carouselOptions.autoPlay&&this.setupPauseOnHover(e)}async displayImage(e,t=!0){const n=this.process.images[e];if(!n)return void console.error("zPhotoCarousel: Invalid image index:",e);!n.loaded&&this._preloader&&await this._preloader.preloadImage(e);const o=n.imageNode;if(!o)return void console.error("zPhotoCarousel: Image not loaded:",e);if(!this.process.currentImage||!t)return this._mainImageContainer.appendChild(o),void this.updateCurrentImage(n);this._activeTransitionController&&(this._activeTransitionController.cancel(),this._activeTransitionController.timeoutId&&clearTimeout(this._activeTransitionController.timeoutId),this._carouselState.isTransitioning=!1,this._activeTransitionController=null);const i=this.process.currentImage.imageNode,s=(a=this._carouselOptions.transition,R[a]||F);var a;const r=this._carouselState.direction||"forward";this._carouselState.isTransitioning=!0;let l=!1;this._activeTransitionController={cancel:()=>{l=!0}};try{await s(i,o,r,this._carouselOptions.transitionDuration,this._mainImageContainer);const e=o.__transitionTimeoutId;e&&this._activeTransitionController&&(this._activeTransitionController.timeoutId=e),l||this.updateCurrentImage(n)}catch(c){l||console.error("zPhotoCarousel: Transition error:",c)}finally{this._carouselState.isTransitioning=!1,this._activeTransitionController=null}}calculateImageOrigin(e){const t=this._mainImageContainer;let n=t.offsetWidth,o=t.offsetHeight;if(this._carouselOptions.enableThumbnails){const e=this._carouselOptions.thumbnailHeight,t=this._carouselOptions.thumbnailPosition;"top"===t||"bottom"===t?o-=e:"left"!==t&&"right"!==t||(n-=e)}n-=2*(.05*n),o-=2*(.05*o);const i=n/o,s=e.prop,a=e.width,r=e.height;let l,c;if(i>s?(c=Math.min(o,r),l=c*s,l>n&&(l=n,c=l/s)):(l=Math.min(n,a),c=l/s,c>o&&(c=o,l=c*s)),l>a||c>r){const e=Math.min(a/l,r/c);l*=e,c*=e}let h=Math.min(l/a,c/r),u=this.process.scaleLimit.min,d=this.process.scaleLimit.max;"number"!=typeof u||u<=0?(u=.3,h<u&&(u=h)):h<u&&(h=u),"number"!=typeof d||d<u?(d=5,h>d&&(d=h,h=3)):h>d&&(h=d);return{width:l,height:c,x:(t.offsetWidth-l)/2,y:(t.offsetHeight-c)/2,scale:h,min:u,max:d}}updateCurrentImage(e){const t=this._mainImageContainer.getBoundingClientRect(),n=e.imageNode,o=e.index,i=this._imageStates.get(o);let s,a,r,l;i&&i.visited?(s=i.scale,a=i.x,r=i.y,l=this.calculateImageOrigin(e)):(l=this.calculateImageOrigin(e),s=l.scale,a=l.x,r=l.y,this._imageStates.set(o,{scale:s,x:a,y:r,visited:!0}));const c=a/s,h=r/s;n.style.transform=`translate3d(${c}px, ${h}px, 0px) scale3d(${s}, ${s}, 1)`,this.process.currentImage={image:e,imageNode:n,animate:!1,factor:s,distanceFactor:1,scale:s,origin:l,center:{x:t.left+t.width/2,y:t.top+t.height/2},minScale:l.min,maxScale:l.max,x:a,y:r,width:()=>this.process.currentImage.imageNode.offsetWidth,height:()=>this.process.currentImage.imageNode.offsetHeight},e.loaded&&e.evener&&e.evener.apply(),this.setupStateTracking(o)}setupStateTracking(e){let t;const n=()=>{this.process.currentImage&&this.process.currentImage.image.index===e&&this._imageStates.set(e,{scale:this.process.currentImage.scale,x:this.process.currentImage.x,y:this.process.currentImage.y,visited:!0})},o=()=>{clearTimeout(t),t=setTimeout(n,300)},i=this._mainImageContainer,s=o,a=o,r=o;i.__stateTrackingCleanup&&i.__stateTrackingCleanup(),i.addEventListener("wheel",s,{passive:!0}),i.addEventListener("mouseup",a),i.addEventListener("touchend",r),i.__stateTrackingCleanup=()=>{clearTimeout(t),i.removeEventListener("wheel",s),i.removeEventListener("mouseup",a),i.removeEventListener("touchend",r)}}next(){if(this._carouselState.isTransitioning)return;const e=this.getNextIndex();e!==this._carouselState.currentIndex&&this.navigateTo(e,"forward")}previous(){if(this._carouselState.isTransitioning)return;const e=this.getPreviousIndex();e!==this._carouselState.currentIndex&&this.navigateTo(e,"backward")}goTo(e){if(this._carouselState.isTransitioning||e<0||e>=this._carouselState.totalImages||e===this._carouselState.currentIndex)return;const t=e>this._carouselState.currentIndex?"forward":"backward";this.navigateTo(e,t)}first(){this.goTo(0)}last(){this.goTo(this._carouselState.totalImages-1)}async navigateTo(e,t){const n=this._carouselState.currentIndex,o=this.process.images[e];let i=!1;const s={from:n,to:e,direction:t,image:o,instance:this,preventDefault:()=>{i=!0},stopPropagation:()=>{}};for(const r of this._navigateCallbacks)if(r(s),i)return;this._carouselState.currentIndex=e,this._carouselState.direction=t,await this.displayImage(e,!0),this.updateUIComponents();const a={index:e,image:o,total:this._carouselState.totalImages,instance:this};for(const r of this._slideChangeCallbacks)r(a);this._preloader&&this._preloader.preloadAdjacent(e)}updateUIComponents(){const e=this._carouselState.currentIndex;this._counter&&this._counter.update(e+1,this._carouselState.totalImages),this._thumbnailBar&&this._thumbnailBar.setActive(e),this._navigationArrows&&this._navigationArrows.updateDisabledState(e,this._carouselState.totalImages,this._carouselOptions.loop)}getNextIndex(){const e=this._carouselState.currentIndex;return e===this._carouselState.totalImages-1?this._carouselOptions.loop?0:e:e+1}getPreviousIndex(){const e=this._carouselState.currentIndex,t=this._carouselState.totalImages;return 0===e?this._carouselOptions.loop?t-1:e:e-1}play(){this._carouselState.isPlaying||(this._carouselState.isPlaying=!0,this._carouselState.playTimer=setInterval(()=>{this.next()},this._carouselOptions.autoPlayInterval))}pause(){this._carouselState.isPlaying&&(this._carouselState.isPlaying=!1,this._carouselState.playTimer&&(clearInterval(this._carouselState.playTimer),this._carouselState.playTimer=null))}togglePlay(){this._carouselState.isPlaying?this.pause():this.play()}getCurrentIndex(){return this._carouselState.currentIndex}getTotalImages(){return this._carouselState.totalImages}getImages(){return this.process.images}isPlaying(){return this._carouselState.isPlaying}onNavigate(e,t){if("function"==typeof e)if(t){const t=this._navigateCallbacks.indexOf(e);t>-1&&this._navigateCallbacks.splice(t,1)}else this._navigateCallbacks.push(e)}onSlideChange(e,t){if("function"==typeof e)if(t){const t=this._slideChangeCallbacks.indexOf(e);t>-1&&this._slideChangeCallbacks.splice(t,1)}else this._slideChangeCallbacks.push(e)}setupPauseOnHover(e){let t=!1;const n=()=>{this._carouselState.isPlaying?(t=!1,this.pause()):t=!0},o=()=>{!t&&this._carouselOptions.autoPlay&&this.play()};this._hoverHandlers={mouseenter:n,mouseleave:o},e.addEventListener("mouseenter",n),e.addEventListener("mouseleave",o)}cleanupPauseOnHover(){if(!this._hoverHandlers)return;const e=this.process.preview?.container;e&&(e.removeEventListener("mouseenter",this._hoverHandlers.mouseenter),e.removeEventListener("mouseleave",this._hoverHandlers.mouseleave)),this._hoverHandlers=null}close(){this.pause(),this._mainImageContainer&&this._mainImageContainer.__stateTrackingCleanup&&(this._mainImageContainer.__stateTrackingCleanup(),delete this._mainImageContainer.__stateTrackingCleanup),this._imageStates.clear(),this._thumbnailBar?.destroy(),this._thumbnailBar=void 0,this._keyboardNav?.destroy(),this._keyboardNav=void 0,this._swipeDetector?.destroy(),this._swipeDetector=void 0,this._navigationArrows?.destroy(),this._navigationArrows=void 0,this._counter?.destroy(),this._counter=void 0,this.cleanupClickHandlers(),this.cleanupPauseOnHover(),this._mainImageContainer&&(this._mainImageContainer.innerHTML=""),super.close()}cleanupClickHandlers(){this._clickHandlers.forEach((e,t)=>{t.removeEventListener("click",e)}),this._clickHandlers.clear(),this._originalEventHandlers.forEach((e,t)=>{e.evener&&e.evener.apply()}),this._originalEventHandlers.clear()}getContainerPreview(){const e=this,t=this.process;let n,o,i,s=!1,a=!1;function r(e){0===e.button&&(a=!0,t.flags.isMoved||(s=!1))}function l(e){(t.flags.isMoved||a)&&(s=!0)}function c(n){const o=t.context.body||t.context.getElementsByTagName("body")[0];if((this===n.target||!o)&&!s&&a)try{e.close()}catch(i){}s=!1,a=!1,n.stopPropagation(),n.preventDefault()}return t.container?(o=t.container,i=t.context):(o=t.context.createElement("DIV"),o.setAttribute("class","ZPhotoZoom"),n=t.context.body||t.context.getElementsByTagName("body")[0],i=o),{container:o,apply:function(){n&&n.appendChild(o)},evener:function(e){e?(i.removeEventListener("mousedown",r),i.removeEventListener("mousemove",l),i.removeEventListener("mouseup",c)):setTimeout(function(){i.addEventListener("mousedown",r),i.addEventListener("mousemove",l),i.addEventListener("mouseup",c)},100)}}}},e.zPhotoZoom=w,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
//# sourceMappingURL=zphotozoom.umd.js.map
