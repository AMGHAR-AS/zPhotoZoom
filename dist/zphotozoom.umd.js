!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).zPhotoZoomLib={})}(this,function(e){"use strict";var t=Object.defineProperty,n=(e,n,i)=>((e,n,i)=>n in e?t(e,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[n]=i)(e,"symbol"!=typeof n?n+"":n,i);function i(e,t,n,i){const o=t.width/t.height;let r,s;if(e.landscape)r=8*t.width/10,s=r/e.prop,s>t.height&&(s=9*t.height/10,r=s*e.prop);else if(o>=e.prop)s=9*t.height/10,r=s*e.prop;else{const n=e.prop-o;s=9*t.height/10-8*t.height/10*n,r=s*e.prop}let a=Math.min(r/e.width,s/e.height);return"number"!=typeof n||n<=0?a<(n=.3)&&(n=a):a<n&&(a=n),"number"!=typeof i||i<n?a>(i=5)&&(i=a,a=3):a>i&&(a=i),{width:r,height:s,x:(t.width-r)/2,y:(t.height-s)/2,scale:a,min:n,max:i}}function o(){const e=this,t=this._process;let n=!1,i=!1;if(e._callPluginHook("beforeClose",{preventDefault:()=>{n=!0},stopPropagation:()=>{i=!0},target:t.currentImage.image.node,instance:e}),!n){for(let o=0;o<t.eventsClose.length;o++){if(t.eventsClose[o]({preventDefault:()=>{n=!0},stopPropagation:()=>{i=!0},target:t.currentImage.image.node,instance:e}),n)return;if(i)break}t.flags={isAnimated:!1,isMoved:!1,wheel:!1,movements:0,updateAttempt:!1,updated:!1,zoomIn:!1,loader:!1,stoped:t.flags.stoped};try{t.currentImage.image.evener.remove()}catch(o){}if(t.container)t.preview.container.removeChild(t.currentImage.imageNode),t.preview.evener(!0);else{(t.context.body||t.context.getElementsByTagName("body")[0]).removeChild(t.preview.container)}t.flags.loader&&(clearTimeout(t.flags.loader),t.flags.loader=!1),t.preview=!1,t.loader=!1,e._callPluginHook("afterClose",{preventDefault:()=>{},stopPropagation:()=>{},target:t.currentImage?.image.node||null,instance:e})}}function r(e,t){const n=this._process;n.container||(n.loader&&(n.preview.container.removeChild(n.loader),n.flags.loader&&(clearTimeout(n.flags.loader),n.flags.loader=!1)),e?(n.loader=n.context.createElement("SPAN"),n.loader.innerText=" "+e):n.loader=n.context.createElement("ZLOADER"),n.loader.style.opacity="1",n.preview.container.appendChild(n.loader),t&&s.call(this,t))}function s(e){const t=this._process;t.loader&&(t.flags.loader&&clearTimeout(t.flags.loader),t.loader.style.transition="opacity "+e+"ms",t.flags.loader=setTimeout(()=>{t.preview&&t.preview.container.removeChild(t.loader),t.loader=!1,t.flags.loader=!1},e))}function a(){const e=this,t=this._process;let n,i,r,s=!1,a=!1;function l(e){0===e.button&&(a=!0,t.flags.isMoved||(s=!1))}function c(e){(t.flags.isMoved||a)&&(s=!0)}function h(n){const i=t.context.body||t.context.getElementsByTagName("body")[0];if((this===n.target||!i)&&!s&&a)try{o.call(e)}catch(r){}s=!1,a=!1,n.stopPropagation(),n.preventDefault()}return t.container?(i=t.container,r=t.context):(i=t.context.createElement("DIV"),i.setAttribute("class","ZPhotoZoom"),n=t.context.body||t.context.getElementsByTagName("body")[0],r=i),{container:i,apply:function(){n&&n.appendChild(i)},evener:function(e){e?(r.removeEventListener("mousedown",l),r.removeEventListener("mousemove",c),r.removeEventListener("mouseup",h)):setTimeout(function(){r.addEventListener("mousedown",l),r.addEventListener("mousemove",c),r.addEventListener("mouseup",h)},100)}}}function l(e){const t=this,n=this._process;let o,s=!1,l=!1;if(t._callPluginHook("beforeOpen",{preventDefault:()=>{s=!0},stopPropagation:()=>{l=!0},target:e.node,instance:t}),s)return;for(let i=0;i<n.eventsOpen.length;i++){if(n.eventsOpen[i]({preventDefault:()=>{s=!0},stopPropagation:()=>{l=!0},target:e.node,instance:t}),s)return;if(l)break}let h={};n.preview=a.call(t),e.loaded?(o=e.imageNode,n.preview.container.appendChild(o),h=i(e,c.call(t).nf,n.scaleLimit.min,n.scaleLimit.max),f.call(t,h.scale,{x:h.x/h.scale,y:h.y/h.scale})):r.call(t),n.preview.apply(),n.preview.evener();const u=c.call(t).nf;n.currentImage={image:e,imageNode:o,animate:!1,factor:h.scale,distanceFactor:1,scale:h.scale,origin:h,center:{x:u.cx,y:u.cy},minScale:h.min,maxScale:h.max,x:h.x,y:h.y,width:function(){return n.currentImage.imageNode.offsetWidth},height:function(){return n.currentImage.imageNode.offsetHeight}},e.loaded&&e.evener.apply(),t._callPluginHook("afterOpen",{preventDefault:()=>{},stopPropagation:()=>{},target:e.node,instance:t})}function c(){const e=this._process.container;if(e){const t=this._process.container.getBoundingClientRect();return{container:e,nf:{width:t.width,height:t.height,top:t.top,left:t.left,cx:t.left+t.width/2,cy:t.top+t.height/2,x:0,y:0}}}return{container:null,nf:{width:window.innerWidth,height:window.innerHeight,top:0,left:0,cx:window.innerWidth/2,cy:window.innerHeight/2,x:0,y:0}}}function h(e){const t=this,n=this._process;let i=0,o=null,r=!1,s=!1,a=null;function l(e){let i=0,o=0;const r=n.context.documentElement.scrollTop||n.context.body.scrollTop,s=n.context.documentElement.scrollLeft||n.context.body.scrollLeft,a=c.call(t).nf;i=a.top+r,o=a.left+s;const l=[];for(let t=0;t<e.length;t++)l.push({x:e[t].pageX-o,y:e[t].pageY-i});return l}function h(e){if(!s){const n=(new Date).getTime();return n-a<320&&(p.call(t,o[0]),m(),e.stopPropagation(),e.preventDefault()),n}return 0}function m(e){a=e||null,r=!1}function f(){o=null,s=!1}function b(e){if("mousedown"===e.type){const t=e;0===t.button&&(r=!0,o=l([t]),e.stopPropagation(),e.preventDefault())}else if("touchstart"===e.type){const t=e;r=!0,i=t.touches.length,o=l(t.touches)}}function v(e){if(!r&&!o){let n=1;e.deltaY<0&&(n=-1),d.call(t,l([e])[0],n),e.stopPropagation(),e.preventDefault()}}function y(e){if(r)if(0===e.button){s=!0;const n=l([e]);o&&u.call(t,o[0],n[0]),o=n,e.stopPropagation(),e.preventDefault()}else m(a),f()}function x(e){if(i>0)if(o)if(1===i){s=!0;const n=l(e.touches);u.call(t,o[0],n[0]),o=n,e.stopPropagation(),e.preventDefault()}else i>=2&&(o.length<2?o=l(e.touches):(g.call(t,o,l(e.touches)),e.stopPropagation(),e.preventDefault()));else o=l(e.touches)}function I(e){0===e.button&&(r&&(a=h(e)),m(a),f())}function w(e){r?(1===i&&(a=h(e),f(),n.currentImage.distanceFactor=1),i=e.touches.length,0===i?(m(),f(),n.flags.movements=0,n.currentImage.distanceFactor=1):f()):(n.flags.movements=0,n.currentImage.distanceFactor=1,m(),f())}return{remove:function(){e.removeEventListener("wheel",v,{passive:!1}),e.removeEventListener("mousedown",b,{passive:!1}),e.removeEventListener("touchstart",b,{passive:!1}),e.removeEventListener("mousemove",y),e.removeEventListener("touchmove",x,{passive:!1}),n.context.removeEventListener("mouseup",I,{passive:!1,capture:!0}),n.context.removeEventListener("touchend",w,{passive:!1,capture:!0})},apply:function(){i=0,o=null,r=!1,s=!1,a=null,e.addEventListener("wheel",v,{passive:!1}),e.addEventListener("mousedown",b,{passive:!1}),e.addEventListener("touchstart",b,{passive:!1}),e.addEventListener("mousemove",y),e.addEventListener("touchmove",x,{passive:!1}),n.context.addEventListener("mouseup",I,{passive:!1,capture:!0}),n.context.addEventListener("touchend",w,{passive:!1,capture:!0})}}}function u(e,t){const n=this._process;n.flags.movements||n.flags.isAnimated||(n.flags.isMoved=!0,n.currentImage.x+=t.x-e.x,n.currentImage.y+=t.y-e.y,f.call(this,n.currentImage.factor,{x:n.currentImage.x/n.currentImage.factor,y:n.currentImage.y/n.currentImage.factor},!1))}function d(e,t){const n=this._process;if(n.flags.updateAttempt||n.flags.stoped)return;t>0?n.currentImage.scale-=.05:n.currentImage.scale+=.05;const i=n.currentImage.factor;n.currentImage.scale=Math.min(n.currentImage.maxScale,Math.max(n.currentImage.scale,n.currentImage.minScale)),n.currentImage.factor=n.currentImage.scale;const o=n.currentImage.imageNode.getBoundingClientRect(),r=c.call(this).nf;n.currentImage.x-=(n.currentImage.factor/i-1)*(e.x-o.left+r.left),n.currentImage.y-=(n.currentImage.factor/i-1)*(e.y-o.top+r.top),f.call(this,n.currentImage.factor,{x:n.currentImage.x/n.currentImage.factor,y:n.currentImage.y/n.currentImage.factor}),n.currentImage.center=e,n.flags.wheel=setTimeout(function(){n.flags.wheel=!1},600)}function p(e){const t=this._process;if(!(t.flags.isAnimated||t.flags.updateAttempt||t.flags.stoped))if(t.currentImage.scale<=t.currentImage.origin.scale){const n=t.currentImage.factor,i=t.currentImage.imageNode.getBoundingClientRect(),o=c.call(this).nf;t.currentImage.scale=Math.min(t.currentImage.maxScale,Math.max(t.currentImage.scale+2,t.currentImage.minScale)),t.currentImage.factor=t.currentImage.scale,t.currentImage.x-=(t.currentImage.factor/n-1)*(e.x-i.left+o.left),t.currentImage.y-=(t.currentImage.factor/n-1)*(e.y-i.top+o.top),t.currentImage.center=e,f.call(this,t.currentImage.factor,{x:t.currentImage.x/t.currentImage.factor,y:t.currentImage.y/t.currentImage.factor},!0)}else m.call(this)}function m(){const e=this._process;e.currentImage.scale=e.currentImage.origin.scale,e.currentImage.factor=e.currentImage.origin.scale,e.currentImage.x=e.currentImage.origin.x,e.currentImage.y=e.currentImage.origin.y,e.currentImage.minScale=e.currentImage.origin.min,e.currentImage.maxScale=e.currentImage.origin.max;const t=c.call(this).nf;e.currentImage.center={x:t.cx,y:t.cy},f.call(this,e.currentImage.factor,{x:e.currentImage.x/e.currentImage.factor,y:e.currentImage.y/e.currentImage.factor},!0)}function g(e,t){const n=this,i=this._process;if(i.flags.updateAttempt||i.flags.stoped)return;const o=i.currentImage.distanceFactor;i.currentImage.distanceFactor=function(e,t){function n(e,t){const n=e.x-t.x,i=e.y-t.y;return Math.sqrt(n*n+i*i)}return n(t[0],t[1])/n(e[0],e[1])}(e,t);const r=i.currentImage.distanceFactor/o;r<1?i.flags.zoomIn||(i.flags.zoomIn=!0):i.flags.zoomIn&&(i.flags.zoomIn=!1),i.currentImage.scale*=r;const s=function(e){if(1===e.length)return{x:e[0].x,y:e[0].y};{const t=Array.prototype.slice.call(e).map(e=>({x:e.x,y:e.y}));return{x:t.map(e=>e.x).reduce((e,t)=>e+t)/t.length,y:t.map(e=>e.y).reduce((e,t)=>e+t)/t.length}}}(t),a=i.currentImage.factor;i.currentImage.factor=Math.min(i.currentImage.maxScale,Math.max(i.currentImage.scale,i.currentImage.minScale));const l=i.currentImage.imageNode.getBoundingClientRect();if(i.flags.movements&&i.flags.movements>1){const e=c.call(n).nf;i.currentImage.x-=(i.currentImage.factor/a-1)*(s.x-l.left+e.left)-(s.x-i.currentImage.center.x),i.currentImage.y-=(i.currentImage.factor/a-1)*(s.y-l.top+e.top)-(s.y-i.currentImage.center.y),i.flags.updated||i.flags.isAnimated||(i.flags.updated=!0,setTimeout(function(){f.call(n,i.currentImage.factor,{x:i.currentImage.x/i.currentImage.factor,y:i.currentImage.y/i.currentImage.factor}),i.flags.updated=!1},0))}i.currentImage.center=s,i.flags.movements+=1}function f(e,t,n){const i=this._process;if(i.flags.isAnimated)return;i.flags.isAnimated=!0;let o=Math.round(100*e);o<100&&(o=" "+o),r.call(this,o+"%",800),setTimeout(function(){i.flags.isAnimated=!1;const o="scale3d("+e+","+e+",1) translate3d("+t.x+"px,"+t.y+"px,0px)",r="scale("+e+", "+e+") translate("+t.x+"px,"+t.y+"px)";i.currentImage.animate&&clearTimeout(i.currentImage.animate),n?i.currentImage.animate=setTimeout(function(){i.currentImage.imageNode.style.transition="",i.currentImage.animate=!1,i.flags.isMoved=!1},500):(i.currentImage.imageNode.style.transition="",i.currentImage.animate=setTimeout(function(){i.flags.isMoved=!1},100)),i.currentImage.imageNode.style.transformOrigin="top left",i.currentImage.imageNode.style.webkitTransformOrigin="top left",i.currentImage.imageNode.style.transform=o,i.currentImage.imageNode.style.webkitTransform=o,i.currentImage.imageNode.style.mozTransform=r,i.currentImage.imageNode.style.msTransform=r,i.currentImage.imageNode.style.oTransform=r})}function b(){const e=this,t=this._process,n=t.selector,o=t.context;function r(n){!function(e,t){const n=new Image;n.onload=function(){const e=this.height,n=this.width;t.call(this,n,e)},n.src=e}(n.src,function(o,r){n.imageNode=this,n.loaded=!0,n.width=o,n.height=r,n.prop=o/r,n.landscape=o>=r,n.evener=h.call(e,this),t.preview&&t.currentImage.image===n&&(t.currentImage.imageNode=this,t.preview.container.appendChild(t.currentImage.imageNode),t.currentImage.origin=i(n,c.call(e).nf,t.scaleLimit.min,t.scaleLimit.max),s.call(e,480),m.call(e),n.evener.apply())})}const a=[];let l=[];if(n&&"string"==typeof n&&o&&Node.DOCUMENT_NODE===o.nodeType)if(/\s+[^#]|>|\[|\.|,/.test(n))l=Array.from(o.querySelectorAll(n));else{const e=o.querySelector(n);e&&(l=[e])}if((Array.isArray(l)||l instanceof NodeList)&&l.length>0)for(let i=0;i<l.length;i++){const e=l[i],t={node:e,src:""};let n=!1;if("IMG"===e.tagName&&e.src)n=e.src;else{const t=getComputedStyle(e).backgroundImage;if(t)if(/^url\(/.test(t))try{const e=t.match(/url\(["']?([^"']*)["']?\)/);n=!!e&&e[1]}catch(u){n=!1}else n=!1}n&&(t.src=n,r(t),a.push(t))}return a}function v(e,t){const n=this;let i=!1,o=!1;function r(t){o||l.call(n,e),o=!1,i=!1}function s(){i=!0}function a(){i&&(o=!0)}t?(e.node.removeEventListener("click",r),e.node.removeEventListener("touchstart",s),e.node.removeEventListener("touchend",r),e.node.removeEventListener("touchmove",a)):(e.node.addEventListener("click",r),e.node.addEventListener("touchstart",s),e.node.addEventListener("touchend",r),e.node.addEventListener("touchmove",a))}function y(){const e=this._process;if(e.images=b.call(this),e.images.length>0)for(let t=0;t<e.images.length;t++)v.call(this,e.images[t])}function x(e,t){Object.defineProperty(this,"_process",{value:{preview:null,loader:null,eventsOpen:[],eventsClose:[],images:[],flags:{isAnimated:!1,isMoved:!1,wheel:!1,movements:0,updateAttempt:!1,updated:!1,zoomIn:!1,loader:!1,stoped:!1},container:e.container,scaleLimit:{min:e.min,max:e.max},selector:e.el,context:t||document,currentImage:null},configurable:!1,enumerable:!1,writable:!1})}function I(){const e=this,t=e._process;y.call(e),window.addEventListener("resize",function(){if(t.preview){const n=i(t.currentImage.image,c.call(e).nf,t.scaleLimit.min,t.scaleLimit.max);t.currentImage.origin=n,function n(){t.flags.updateAttempt=setTimeout(function(){t.flags.isAnimated?n():(m.call(e),t.flags.updateAttempt=!1)},70)}()}})}class w{constructor(e,t){if(n(this,"_process"),n(this,"_plugins",new Map),(()=>{if(document.getElementById("z-photo-zoom-styles"))return;const e=document.createElement("style");e.id="z-photo-zoom-styles",e.textContent="\n    .ZPhotoZoom {\n      position: fixed;\n      left: 0;\n      top: 0;\n      width: 100vw;\n      height: 100vh;\n      background-color: rgba(0, 0, 0, 0.7);\n      z-index: 999999999;\n      -webkit-user-select: none;\n      -moz-user-select: none;\n      -ms-user-select: none;\n      user-select: none;\n    }\n\n    .ZPhotoZoom img {\n      position: absolute;\n      cursor: grab;\n    }\n\n    .ZPhotoZoom img:active {\n      cursor: grabbing;\n    }\n\n    .ZPhotoZoom span {\n      color: white;\n      line-height: 30px;\n      font-weight: bold;\n      position: fixed;\n      top: calc(50vh - 25px);\n      left: calc(50vw - 15px);\n      background-color: rgba(114, 123, 135, 0.5);\n      width: 50px;\n      height: 30px;\n      display: inline-block;\n      vertical-align: middle;\n      border-radius: 5px;\n      text-align: center;\n    }\n\n    .ZPhotoZoom zloader {\n      position: fixed;\n      top: calc(50vh - 50px);\n      left: calc(50vw - 50px);\n      width: 40px;\n      height: 40px;\n      display: inline-block;\n      vertical-align: middle;\n      border-radius: 40px;\n      border: 6px solid rgba(114, 123, 135, 0.4);\n    }\n\n    .ZPhotoZoom zloader:after {\n      content: '';\n      position: absolute;\n      top: -6px;\n      left: -6px;\n      bottom: -6px;\n      right: -6px;\n      width: 40px;\n      height: 40px;\n      border-radius: 40px;\n      border: 6px solid transparent;\n      border-top-color: rgba(38, 38, 38, 0.27);\n      -webkit-animation: zPhotoZoomSpin 1s linear infinite;\n      animation: zPhotoZoomSpin 1s linear infinite;\n    }\n\n    @keyframes zPhotoZoomSpin {\n      0% {\n        -webkit-transform: rotate(0deg);\n        transform: rotate(0deg);\n      }\n      100% {\n        -webkit-transform: rotate(360deg);\n        transform: rotate(360deg);\n      }\n    }\n  ",document.head.appendChild(e)})(),!(this instanceof w))return console.error("zPhotoZoom is a class and can only be called with the keyword 'new'");e&&("object"==typeof e&&x.call(this,e,t),"string"==typeof e.el&&I.call(this))}stop(){this._process.flags.stoped=!0}resume(){this._process.flags.stoped=!1}reset(){this._process.preview&&m.call(this)}close(){this._process.preview&&o.call(this)}update(){const e=this._process;e.preview&&f.call(this,e.currentImage.factor,{x:e.currentImage.x/e.currentImage.factor,y:e.currentImage.y/e.currentImage.factor})}change(e){const t=this._process;if("string"==typeof e){t.preview&&o.call(this);for(let e=0;e<t.images.length;e++)v.call(this,t.images[e],!0);t.selector=e,t.images=[],y.call(this)}}onOpen(e,t){const n=this._process;if("function"==typeof e)if(t)for(let i=n.eventsOpen.length-1;i>=0;i--)n.eventsOpen[i]===e&&n.eventsOpen.splice(i,1);else n.eventsOpen.push(e)}onClose(e,t){const n=this._process;if("function"==typeof e)if(t)for(let i=n.eventsClose.length-1;i>=0;i--)n.eventsClose[i]===e&&n.eventsClose.splice(i,1);else n.eventsClose.push(e)}registerPlugin(e){if(this._plugins.has(e.name))return void console.warn(`Plugin "${e.name}" is already registered`);const t={getImageState:()=>this.getImageState(),setImageTransform:(e,t,n,i)=>this.setImageTransform(e,t,n,i),centerImage:e=>this.centerImageWithOptions(e),resetImage:()=>this.reset(),getCurrentImageElement:()=>this.getCurrentImageElement(),getPreviewContainer:()=>this.getPreviewContainer(),isViewerOpen:()=>this.isViewerOpen(),closeViewer:()=>this.close()};this._plugins.set(e.name,{plugin:e,api:t}),e.initialize(this,t),e.onRegister&&e.onRegister()}unregisterPlugin(e){const t=this._plugins.get(e);t?(t.plugin.onDestroy&&t.plugin.onDestroy(),t.plugin.destroy&&t.plugin.destroy(),this._plugins.delete(e)):console.warn(`Plugin "${e}" is not registered`)}getPlugin(e){return this._plugins.get(e)?.plugin}_callPluginHook(e,...t){this._plugins.forEach(({plugin:n})=>{const i=n[e];"function"==typeof i&&i.apply(n,t)})}getImageState(){const e=this._process;return e.currentImage?{scale:e.currentImage.scale,x:e.currentImage.x,y:e.currentImage.y,minScale:e.currentImage.minScale,maxScale:e.currentImage.maxScale}:null}setImageTransform(e,t,n,i){const o=this._process;o.preview&&o.currentImage&&(o.currentImage.scale=e,o.currentImage.factor=e,o.currentImage.x=t,o.currentImage.y=n,f.call(this,e,{x:t/e,y:n/e},i),this._callPluginHook("onTransformChange",this.getImageState()))}centerImageWithOptions(e){const t=this._process;if(!t.preview||!t.currentImage)return;let n=c.call(this).nf;if(e?.reservedSpaces){const{top:t=0,bottom:i=0,left:o=0,right:r=0}=e.reservedSpaces;n={...n,width:n.width-o-r,height:n.height-t-i,x:n.x+o,y:n.y+t,cx:n.cx,cy:n.cy,top:n.top+t,left:n.left+o}}const o=e?.marginPercent??.05;if(o>0){const e=n.width*o,t=n.height*o;n={...n,width:n.width-2*e,height:n.height-2*t,x:n.x+e,y:n.y+t,cx:n.cx,cy:n.cy,top:n.top+t,left:n.left+e}}const r=t.currentImage.image,s=i(r,n,t.scaleLimit.min,t.scaleLimit.max);if(!e?.allowUpscale){const e=Math.min(r.width/s.width,r.height/s.height);s.scale>e&&(s.scale=e,s.width=r.width*s.scale,s.height=r.height*s.scale,s.x=(n.width-s.width)/2,s.y=(n.height-s.height)/2)}t.currentImage.origin=s,this.setImageTransform(s.scale,s.x,s.y,!1)}getCurrentImageElement(){return this._process.currentImage?.imageNode||null}getPreviewContainer(){return this._process.preview?.container||null}isViewerOpen(){return!!this._process.preview}}var _=Object.defineProperty,z=(e,t,n)=>((e,t,n)=>t in e?_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);const C={ArrowLeft:"previous",ArrowRight:"next",Escape:"close",Home:"first",End:"last",Space:"togglePlay"};class P{constructor(e){z(this,"options"),z(this,"enabled"),z(this,"boundHandler",null),this.options=e,this.enabled=e.enabled,this.enabled&&this.enable()}enable(){this.enabled&&this.boundHandler||(this.enabled=!0,this.boundHandler=this.handleKeyDown.bind(this),document.addEventListener("keydown",this.boundHandler))}disable(){this.enabled&&this.boundHandler&&(this.enabled=!1,document.removeEventListener("keydown",this.boundHandler),this.boundHandler=null)}destroy(){this.disable()}handleKeyDown(e){if(!this.enabled)return;const t=e.target;if(["INPUT","TEXTAREA","SELECT","BUTTON"].includes(t.tagName)||t.isContentEditable||t.closest('[contenteditable="true"]'))return;const n=C[e.key];if(n)switch(e.preventDefault(),e.stopPropagation(),n){case"next":this.options.onNext();break;case"previous":this.options.onPrevious();break;case"close":this.options.onClose();break;case"first":this.options.onFirst();break;case"last":this.options.onLast();break;case"togglePlay":this.options.onTogglePlay&&this.options.onTogglePlay()}}}var S=Object.defineProperty,E=(e,t,n)=>((e,t,n)=>t in e?S(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);class T{constructor(e){if(E(this,"options"),E(this,"images"),E(this,"loadingQueue",new Set),E(this,"loadedIndices",new Set),this.options=e,this.images=e.images||[],!Array.isArray(this.images))return console.error("zPhotoCarousel: Preloader requires an array of images"),void(this.images=[]);this.options.preloadAll&&this.images.length>0&&this.preloadAll().catch(e=>{console.warn("zPhotoCarousel: Error preloading all images:",e)})}async preloadImage(e){if(e<0||e>=this.images.length)return Promise.reject(new Error(`Invalid index: ${e}`));const t=this.images[e];return t?t.loaded||this.loadedIndices.has(e)?Promise.resolve():this.loadingQueue.has(e)?this.waitForLoad(e):(this.loadingQueue.add(e),new Promise(n=>{const i=new Image;i.onload=()=>{t.imageNode=i,t.loaded=!0,t.width=i.naturalWidth,t.height=i.naturalHeight,t.prop=i.naturalWidth/i.naturalHeight,t.landscape=i.naturalWidth>=i.naturalHeight,this.loadedIndices.add(e),this.loadingQueue.delete(e),n()},i.onerror=()=>{console.warn(`zPhotoCarousel: Failed to load image at index ${e}:`,t.src),t.imageNode=i,t.loaded=!0,t.failed=!0,this.loadedIndices.add(e),this.loadingQueue.delete(e),n()},i.src=t.src})):Promise.reject(new Error(`Image data not found at index: ${e}`))}async preloadAdjacent(e){if(!this.options.preloadAdjacent)return Promise.resolve();const t=this.images.length;if(0===t||e<0||e>=t)return Promise.resolve();const n=[],i=(e+1)%t,o=this.images[i];!o||o.loaded||this.loadedIndices.has(i)||n.push(i);const r=0===e?t-1:e-1,s=this.images[r];!s||s.loaded||this.loadedIndices.has(r)||n.push(r);try{await Promise.all(n.map(e=>this.preloadImage(e)))}catch(a){console.warn("zPhotoCarousel: Some adjacent images failed to preload",a)}}async preloadAll(){if(!this.options.preloadAll)return Promise.resolve();const e=[];for(let n=0;n<this.images.length;n++){const t=this.images[n];!t||t.loaded||this.loadedIndices.has(n)||e.push(n)}for(let n=0;n<e.length;n+=3){const i=e.slice(n,n+3);try{await Promise.all(i.map(e=>this.preloadImage(e)))}catch(t){console.warn("zPhotoCarousel: Some images failed to preload in batch",t)}}}waitForLoad(e){return new Promise(t=>{let n;const i=setInterval(()=>{this.loadingQueue.has(e)||(clearInterval(i),clearTimeout(n),t())},50);n=setTimeout(()=>{clearInterval(i),console.warn(`zPhotoCarousel: Preload timeout for image at index ${e}`),t()},1e4)})}getStats(){const e=this.images.length,t=this.loadedIndices.size;return{loaded:t,total:e,percentage:e>0?Math.round(t/e*100):0}}}var k=Object.defineProperty,A=(e,t,n)=>((e,t,n)=>t in e?k(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);class L{constructor(e){A(this,"options"),A(this,"element"),A(this,"startPoint",null),A(this,"enabled",!0),A(this,"boundTouchStart",null),A(this,"boundTouchMove",null),A(this,"boundTouchEnd",null),this.options=e,this.element=e.element,this.enable()}enable(){this.boundTouchStart||(this.enabled=!0,this.boundTouchStart=this.handleTouchStart.bind(this),this.boundTouchMove=this.handleTouchMove.bind(this),this.boundTouchEnd=this.handleTouchEnd.bind(this),this.element.addEventListener("touchstart",this.boundTouchStart,{passive:!1}),this.element.addEventListener("touchmove",this.boundTouchMove,{passive:!1}),this.element.addEventListener("touchend",this.boundTouchEnd,{passive:!1}))}disable(){this.boundTouchStart&&(this.enabled=!1,this.element.removeEventListener("touchstart",this.boundTouchStart),this.element.removeEventListener("touchmove",this.boundTouchMove),this.element.removeEventListener("touchend",this.boundTouchEnd),this.boundTouchStart=null,this.boundTouchMove=null,this.boundTouchEnd=null)}destroy(){this.disable()}handleTouchStart(e){if(this.enabled&&this.options.isEnabled())if(1===e.touches.length){const t=e.touches[0];t&&(this.startPoint={x:t.clientX,y:t.clientY,time:Date.now()})}else this.startPoint=null}handleTouchMove(e){this.enabled&&this.startPoint&&this.options.isEnabled()&&e.touches.length>1&&(this.startPoint=null)}handleTouchEnd(e){if(!this.enabled||!this.startPoint||!this.options.isEnabled())return void(this.startPoint=null);const t=e.changedTouches[0];if(!t)return void(this.startPoint=null);const n={x:t.clientX,y:t.clientY,time:Date.now()};this.detectSwipe(this.startPoint,n),this.startPoint=null}detectSwipe(e,t){const n=t.x-e.x,i=t.y-e.y,o=t.time-e.time,r=Math.abs(n);r<=Math.abs(i)||r<this.options.threshold||o>300||(n>0?this.options.onSwipeRight():this.options.onSwipeLeft())}}var N=Object.defineProperty,O=(e,t,n)=>((e,t,n)=>t in e?N(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);class H{constructor(e){O(this,"options"),O(this,"container",null),O(this,"track",null),O(this,"thumbnails",[]),O(this,"currentIndex"),this.options=e,this.currentIndex=e.currentIndex}render(){this.container=document.createElement("div"),this.container.className=`zpz-thumbnail-bar zpz-tb-${this.options.position}`,this.container.style.height=`${this.options.height}px`;const e=document.createElement("div");return e.className="zpz-tb-container",this.container.appendChild(e),this.track=document.createElement("div"),this.track.className="zpz-tb-track",e.appendChild(this.track),this.options.images.forEach((e,t)=>{const n=this.createThumbnail(e,t);this.thumbnails.push(n),this.track.appendChild(n)}),this.setActive(this.currentIndex),this.container}createThumbnail(e,t){const n=document.createElement("div");n.className="zpz-tb-item",n.setAttribute("data-index",t.toString()),n.setAttribute("role","button"),n.setAttribute("tabindex","0"),n.setAttribute("aria-label",`View image ${t+1}`);const i="top"===this.options.position||"bottom"===this.options.position,o=i?this.options.height-20:this.options.height;i?n.style.width=`${o}px`:n.style.height=`${o}px`;const r=document.createElement("img");return r.src=e.thumbnailSrc||e.src,r.alt=`Thumbnail ${t+1}`,r.draggable=!1,r.style.pointerEvents="none",n.appendChild(r),n.addEventListener("click",()=>{this.options.onThumbnailClick(t)}),n.addEventListener("keydown",e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),this.options.onThumbnailClick(t))}),n}setActive(e){if(e<0||e>=this.thumbnails.length)return;if(this.currentIndex>=0&&this.currentIndex<this.thumbnails.length){const e=this.thumbnails[this.currentIndex];e&&(e.classList.remove("zpz-tb-active"),e.setAttribute("aria-selected","false"))}const t=this.thumbnails[e];t&&(t.classList.add("zpz-tb-active"),t.setAttribute("aria-selected","true")),this.currentIndex=e,this.scrollToActive()}scrollToActive(){if(!this.track||!this.container||this.currentIndex<0)return;const e=this.thumbnails[this.currentIndex];e&&e.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"})}update(e){this.track&&(this.track.innerHTML="",this.thumbnails=[],e.forEach((e,t)=>{const n=this.createThumbnail(e,t);this.thumbnails.push(n),this.track.appendChild(n)}),this.setActive(0))}destroy(){this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container),this.container=null,this.track=null,this.thumbnails=[]}}var M=Object.defineProperty,D=(e,t,n)=>((e,t,n)=>t in e?M(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);class B{constructor(e,t,n="center"){this.onPrevious=e,this.onNext=t,this.position=n,D(this,"container",null),D(this,"prevButton",null),D(this,"nextButton",null)}render(){return this.container=document.createElement("div"),this.container.className=`zpz-nav-arrows zpz-arrows-${this.position}`,this.prevButton=this.createArrowButton("prev",this.onPrevious),this.container.appendChild(this.prevButton),this.nextButton=this.createArrowButton("next",this.onNext),this.container.appendChild(this.nextButton),this.container}createArrowButton(e,t){const n=document.createElement("button");n.className=`zpz-arrow zpz-arrow-${e}`,n.setAttribute("aria-label","prev"===e?"Previous image":"Next image"),n.type="button";const i=this.createArrowIcon(e);return n.appendChild(i),n.addEventListener("click",e=>{e.stopPropagation(),t()}),n}createArrowIcon(e){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("width","24"),t.setAttribute("height","24"),t.setAttribute("viewBox","0 0 24 24"),t.setAttribute("fill","none"),t.setAttribute("stroke","currentColor"),t.setAttribute("stroke-width","2"),t.setAttribute("stroke-linecap","round"),t.setAttribute("stroke-linejoin","round");const n=document.createElementNS("http://www.w3.org/2000/svg","path");return"prev"===e?n.setAttribute("d","M15 18l-6-6 6-6"):n.setAttribute("d","M9 18l6-6-6-6"),t.appendChild(n),t}updateDisabledState(e,t,n){this.prevButton&&this.nextButton&&(n?(this.prevButton.disabled=!1,this.nextButton.disabled=!1):(this.prevButton.disabled=0===e,this.nextButton.disabled=e===t-1))}destroy(){this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container),this.container=null,this.prevButton=null,this.nextButton=null}}var j=Object.defineProperty,Z=(e,t,n)=>((e,t,n)=>t in e?j(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);class ${constructor(e="top-right"){this.position=e,Z(this,"container",null),Z(this,"currentSpan",null),Z(this,"totalSpan",null)}render(){this.container=document.createElement("div"),this.container.className=`zpz-counter zpz-counter-${this.position}`,this.container.setAttribute("aria-live","polite"),this.container.setAttribute("aria-atomic","true"),this.currentSpan=document.createElement("span"),this.currentSpan.className="zpz-counter-current",this.currentSpan.textContent="1";const e=document.createElement("span");return e.className="zpz-counter-separator",e.textContent="/",this.totalSpan=document.createElement("span"),this.totalSpan.className="zpz-counter-total",this.totalSpan.textContent="1",this.container.appendChild(this.currentSpan),this.container.appendChild(e),this.container.appendChild(this.totalSpan),this.container}update(e,t){this.currentSpan&&this.totalSpan&&(this.currentSpan.textContent=e.toString(),this.totalSpan.textContent=t.toString(),this.container&&this.container.setAttribute("aria-label",`Image ${e} of ${t}`))}destroy(){this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container),this.container=null,this.currentSpan=null,this.totalSpan=null}}const F=async(e,t,n,i,o)=>new Promise((r,s)=>{if(e&&t&&o){!o.contains(e)&&e.parentNode&&console.warn("zPhotoCarousel: fromElement is not in the expected container");try{const s="forward"===n?"100%":"-100%",a="forward"===n?"-100%":"100%";t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="100%",t.style.transform=`translateX(${s})`,t.style.opacity="1",t.parentNode!==o&&o.appendChild(t),t.offsetHeight;const l="cubic-bezier(0.4, 0, 0.2, 1)";e.style.transition=`transform ${i}ms ${l}`,t.style.transition=`transform ${i}ms ${l}`,e.style.transform=`translateX(${a})`,t.style.transform="translateX(0)";const c=setTimeout(()=>{try{e.parentNode===o&&o.removeChild(e),e.style.transform="",e.style.transition="",e.style.position="",t.style.transition="",t.style.position="",r()}catch(n){console.error("zPhotoCarousel: Error during transition cleanup:",n),r()}},i);t.__transitionTimeoutId=c}catch(a){console.error("zPhotoCarousel: Error during slide transition:",a),s(a)}}else s(new Error("Transition requires valid fromElement, toElement, and container"))}),R={slide:F,fade:async(e,t,n,i,o)=>new Promise((n,r)=>{if(e&&t&&o){!o.contains(e)&&e.parentNode&&console.warn("zPhotoCarousel: fromElement is not in the expected container");try{t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="100%",t.style.opacity="0",t.parentNode!==o&&o.appendChild(t),t.offsetHeight,e.style.transition=`opacity ${i}ms ease`,t.style.transition=`opacity ${i}ms ease`,e.style.opacity="0",t.style.opacity="1";const r=setTimeout(()=>{try{e.parentNode===o&&o.removeChild(e),e.style.opacity="",e.style.transition="",e.style.position="",t.style.transition="",t.style.position="",n()}catch(i){console.error("zPhotoCarousel: Error during transition cleanup:",i),n()}},i);t.__transitionTimeoutId=r}catch(s){console.error("zPhotoCarousel: Error during fade transition:",s),r(s)}}else r(new Error("Transition requires valid fromElement, toElement, and container"))}),none:async(e,t,n,i,o)=>new Promise((n,i)=>{if(e&&t&&o)try{t.parentNode!==o&&o.appendChild(t),e.parentNode===o&&o.removeChild(e),n()}catch(r){console.error("zPhotoCarousel: Error during instant transition:",r),i(r)}else i(new Error("Transition requires valid fromElement, toElement, and container"))})};var V=Object.defineProperty,W=(e,t,n)=>((e,t,n)=>t in e?V(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);e.default=w,e.zPhotoCarousel=class extends w{constructor(e,t){(()=>{if(document.getElementById("z-photo-carousel-styles"))return;const e=document.createElement("style");e.id="z-photo-carousel-styles",e.textContent="\n    /* Carousel main container modifications */\n    .ZPhotoZoom.zpz-carousel-mode {\n      display: flex;\n      flex-direction: column;\n    }\n\n    .zpz-main-image-container {\n      position: relative;\n      flex: 1;\n      overflow: hidden;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n    }\n\n    .zpz-main-image-container img {\n      position: absolute;\n      max-width: 100%;\n      max-height: 100%;\n    }\n\n    /* Navigation Arrows */\n    .zpz-nav-arrows {\n      position: absolute;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      pointer-events: none;\n      z-index: 999;\n    }\n\n    .zpz-arrow {\n      pointer-events: auto;\n      position: absolute;\n      top: 50%;\n      transform: translateY(-50%);\n      background: rgba(0, 0, 0, 0.5);\n      backdrop-filter: blur(10px);\n      border: 2px solid rgba(255, 255, 255, 0.2);\n      width: 50px;\n      height: 50px;\n      border-radius: 50%;\n      cursor: pointer;\n      transition: all 0.3s ease;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      color: white;\n      outline: none;\n    }\n\n    .zpz-arrow:hover:not(:disabled) {\n      background: rgba(102, 126, 234, 0.8);\n      border-color: rgba(102, 126, 234, 1);\n      transform: translateY(-50%) scale(1.1);\n    }\n\n    .zpz-arrow:active:not(:disabled) {\n      transform: translateY(-50%) scale(0.95);\n    }\n\n    .zpz-arrow:disabled {\n      opacity: 0.3;\n      cursor: not-allowed;\n    }\n\n    .zpz-arrow:focus-visible {\n      outline: 2px solid #667eea;\n      outline-offset: 2px;\n    }\n\n    .zpz-arrow-prev {\n      left: 20px;\n    }\n\n    .zpz-arrow-next {\n      right: 20px;\n    }\n\n    .zpz-arrow svg {\n      width: 24px;\n      height: 24px;\n      fill: none;\n    }\n\n    /* Counter */\n    .zpz-counter {\n      position: absolute;\n      background: rgba(0, 0, 0, 0.7);\n      backdrop-filter: blur(10px);\n      padding: 8px 16px;\n      border-radius: 20px;\n      color: white;\n      font-size: 16px;\n      font-weight: 500;\n      z-index: 1000;\n      user-select: none;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n    }\n\n    .zpz-counter-top-left {\n      top: 20px;\n      left: 20px;\n    }\n\n    .zpz-counter-top-right {\n      top: 20px;\n      right: 20px;\n    }\n\n    .zpz-counter-bottom-left {\n      bottom: 20px;\n      left: 20px;\n    }\n\n    .zpz-counter-bottom-right {\n      bottom: 20px;\n      right: 20px;\n    }\n\n    .zpz-counter-separator {\n      margin: 0 8px;\n      opacity: 0.6;\n    }\n\n    /* Thumbnail Bar */\n    .zpz-thumbnail-bar {\n      position: absolute;\n      background: linear-gradient(180deg, rgba(0, 0, 0, 0.95) 0%, rgba(0, 0, 0, 0.85) 100%);\n      backdrop-filter: blur(20px);\n      z-index: 1000;\n      border-top: 1px solid rgba(255, 255, 255, 0.1);\n    }\n\n    .zpz-tb-bottom {\n      bottom: 0;\n      left: 0;\n      right: 0;\n    }\n\n    .zpz-tb-top {\n      top: 0;\n      left: 0;\n      right: 0;\n      border-top: none;\n      border-bottom: 1px solid rgba(255, 255, 255, 0.1);\n    }\n\n    .zpz-tb-left {\n      left: 0;\n      top: 0;\n      bottom: 0;\n      border-top: none;\n      border-right: 1px solid rgba(255, 255, 255, 0.1);\n    }\n\n    .zpz-tb-right {\n      right: 0;\n      top: 0;\n      bottom: 0;\n      border-top: none;\n      border-left: 1px solid rgba(255, 255, 255, 0.1);\n    }\n\n    .zpz-tb-container {\n      width: 100%;\n      height: 100%;\n      overflow-x: auto;\n      overflow-y: hidden;\n      padding: 12px 16px;\n      scroll-behavior: smooth;\n      -webkit-overflow-scrolling: touch;\n    }\n\n    .zpz-tb-left .zpz-tb-container,\n    .zpz-tb-right .zpz-tb-container {\n      overflow-x: hidden;\n      overflow-y: auto;\n    }\n\n    /* Custom scrollbar for webkit browsers */\n    .zpz-tb-container::-webkit-scrollbar {\n      height: 6px;\n      width: 6px;\n    }\n\n    .zpz-tb-container::-webkit-scrollbar-track {\n      background: rgba(255, 255, 255, 0.05);\n      border-radius: 3px;\n    }\n\n    .zpz-tb-container::-webkit-scrollbar-thumb {\n      background: rgba(255, 255, 255, 0.2);\n      border-radius: 3px;\n    }\n\n    .zpz-tb-container::-webkit-scrollbar-thumb:hover {\n      background: rgba(255, 255, 255, 0.3);\n    }\n\n    .zpz-tb-track {\n      display: flex;\n      gap: 12px;\n      height: 100%;\n      justify-content: center;\n      align-items: center;\n      min-width: min-content;\n    }\n\n    .zpz-tb-bottom .zpz-tb-track,\n    .zpz-tb-top .zpz-tb-track {\n      flex-direction: row;\n    }\n\n    .zpz-tb-left .zpz-tb-track,\n    .zpz-tb-right .zpz-tb-track {\n      flex-direction: column;\n    }\n\n    .zpz-tb-item {\n      flex: 0 0 auto;\n      cursor: pointer;\n      border: 2px solid rgba(255, 255, 255, 0.15);\n      border-radius: 8px;\n      overflow: hidden;\n      transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);\n      background: rgba(255, 255, 255, 0.05);\n      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);\n      position: relative;\n    }\n\n    .zpz-tb-item::after {\n      content: '';\n      position: absolute;\n      inset: 0;\n      background: linear-gradient(180deg, transparent 0%, rgba(0, 0, 0, 0.2) 100%);\n      opacity: 0;\n      transition: opacity 0.25s ease;\n    }\n\n    .zpz-tb-item:hover {\n      border-color: rgba(255, 255, 255, 0.4);\n      transform: translateY(-4px) scale(1.05);\n      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.5);\n    }\n\n    .zpz-tb-item:hover::after {\n      opacity: 1;\n    }\n\n    .zpz-tb-item:focus-visible {\n      outline: 3px solid #667eea;\n      outline-offset: 3px;\n    }\n\n    .zpz-tb-item.zpz-tb-active {\n      border-color: #667eea;\n      border-width: 3px;\n      box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2),\n                  0 4px 20px rgba(102, 126, 234, 0.6);\n      transform: scale(1.1);\n    }\n\n    .zpz-tb-item.zpz-tb-active::after {\n      opacity: 0;\n    }\n\n    .zpz-tb-item img {\n      width: 100%;\n      height: 100%;\n      object-fit: cover;\n      display: block;\n    }\n\n    /* Mobile responsive */\n    @media (max-width: 768px) {\n      .zpz-tb-bottom,\n      .zpz-tb-top {\n        height: 80px !important;\n      }\n\n      .zpz-arrow {\n        width: 40px;\n        height: 40px;\n      }\n\n      .zpz-arrow svg {\n        width: 20px;\n        height: 20px;\n      }\n\n      .zpz-arrow-prev {\n        left: 10px;\n      }\n\n      .zpz-arrow-next {\n        right: 10px;\n      }\n\n      .zpz-counter {\n        font-size: 14px;\n        padding: 6px 12px;\n      }\n    }\n  ",document.head.appendChild(e)})(),super(e,t),W(this,"_carouselState"),W(this,"_carouselOptions"),W(this,"_thumbnailBar"),W(this,"_keyboardNav"),W(this,"_preloader"),W(this,"_swipeDetector"),W(this,"_navigationArrows"),W(this,"_counter"),W(this,"_navigateCallbacks",[]),W(this,"_slideChangeCallbacks",[]),W(this,"_mainImageContainer"),W(this,"_clickHandlers",new Map),W(this,"_hoverHandlers",null),W(this,"_activeTransitionController",null),W(this,"_originalEventHandlers",new Map),W(this,"_imageStates",new Map),this._carouselOptions={...e,carousel:!1!==e.carousel,loop:!1!==e.loop,startIndex:e.startIndex||0,enableThumbnails:!1!==e.enableThumbnails,thumbnailHeight:e.thumbnailHeight||120,thumbnailPosition:e.thumbnailPosition||"bottom",thumbnailsVisible:e.thumbnailsVisible||5,enableKeyboard:!1!==e.enableKeyboard,enableArrows:!1!==e.enableArrows,arrowPosition:e.arrowPosition||"center",enableSwipe:!1!==e.enableSwipe,transition:e.transition||"slide",transitionDuration:e.transitionDuration||400,autoPlay:e.autoPlay||!1,autoPlayInterval:e.autoPlayInterval||3e3,pauseOnHover:!1!==e.pauseOnHover,preloadAdjacent:!1!==e.preloadAdjacent,preloadAll:e.preloadAll||!1,showCounter:!1!==e.showCounter,counterPosition:e.counterPosition||"top-right"},this._carouselState={currentIndex:this._carouselOptions.startIndex,totalImages:this.process.images.length,isPlaying:!1,playTimer:null,isTransitioning:!1,direction:null},this.initializeCarousel()}get process(){return this._process}initializeCarousel(){this._carouselOptions.carousel&&(this.process.images.forEach((e,t)=>{e.index=t}),(this._carouselOptions.preloadAdjacent||this._carouselOptions.preloadAll)&&(this._preloader=new T({images:this.process.images,preloadAdjacent:this._carouselOptions.preloadAdjacent,preloadAll:this._carouselOptions.preloadAll})),this.process.images.forEach((e,t)=>{e.evener&&(this._originalEventHandlers.set(e.node,{evener:e.evener}),e.evener.remove());const n=this._clickHandlers.get(e.node);n&&e.node.removeEventListener("click",n);const i=e=>{e.preventDefault(),e.stopPropagation(),this.openCarouselAt(t)};this._clickHandlers.set(e.node,i),e.node.addEventListener("click",i)}))}openCarouselAt(e){this._carouselState.currentIndex=e;const t=this.process.images[e];this.openCarouselViewer(t)}openCarouselViewer(e){let t=!1;for(let n=0;n<this.process.eventsOpen.length;n++){const i={preventDefault:()=>{t=!0},stopPropagation:()=>{},target:e.node,instance:this};if(this.process.eventsOpen[n](i),t)return}this.createCarouselStructure(),this.setupCarouselComponents(),this.displayImage(this._carouselState.currentIndex,!1),this._preloader&&this._preloader.preloadAdjacent(this._carouselState.currentIndex),this._carouselOptions.autoPlay&&this.play()}createCarouselStructure(){if(!this.process.preview){const e=this.getContainerPreview();this.process.preview=e,this.process.preview.apply(),this.process.preview.evener()}const e=this.process.preview.container;e.classList.add("zpz-carousel-mode"),this._mainImageContainer&&this._mainImageContainer.parentNode?this._mainImageContainer.innerHTML="":(this._mainImageContainer=document.createElement("div"),this._mainImageContainer.className="zpz-main-image-container",e.appendChild(this._mainImageContainer))}setupCarouselComponents(){const e=this.process.preview.container;this._carouselOptions.enableArrows&&(this._navigationArrows=new B(()=>this.previous(),()=>this.next(),this._carouselOptions.arrowPosition),this._mainImageContainer.appendChild(this._navigationArrows.render()),this._navigationArrows.updateDisabledState(this._carouselState.currentIndex,this._carouselState.totalImages,this._carouselOptions.loop)),this._carouselOptions.showCounter&&(this._counter=new $(this._carouselOptions.counterPosition),this._mainImageContainer.appendChild(this._counter.render()),this._counter.update(this._carouselState.currentIndex+1,this._carouselState.totalImages)),this._carouselOptions.enableThumbnails&&(this._thumbnailBar=new H({images:this.process.images,position:this._carouselOptions.thumbnailPosition,height:this._carouselOptions.thumbnailHeight,visibleCount:this._carouselOptions.thumbnailsVisible,currentIndex:this._carouselState.currentIndex,onThumbnailClick:e=>this.goTo(e)}),e.appendChild(this._thumbnailBar.render())),this._carouselOptions.enableKeyboard&&(this._keyboardNav=new P({onNext:()=>this.next(),onPrevious:()=>this.previous(),onClose:()=>this.close(),onFirst:()=>this.first(),onLast:()=>this.last(),onTogglePlay:()=>this.togglePlay(),enabled:!0})),this._carouselOptions.enableSwipe&&this._mainImageContainer&&(this._swipeDetector=new L({element:this._mainImageContainer,threshold:50,onSwipeLeft:()=>this.next(),onSwipeRight:()=>this.previous(),isEnabled:()=>this.process.currentImage?.scale===this.process.currentImage?.origin.scale})),this._carouselOptions.pauseOnHover&&this._carouselOptions.autoPlay&&this.setupPauseOnHover(e)}async displayImage(e,t=!0){const n=this.process.images[e];if(!n)return void console.error("zPhotoCarousel: Invalid image index:",e);!n.loaded&&this._preloader&&await this._preloader.preloadImage(e);const i=n.imageNode;if(!i)return void console.error("zPhotoCarousel: Image not loaded:",e);if(!this.process.currentImage||!t)return this._mainImageContainer.appendChild(i),void this.updateCurrentImage(n);this._activeTransitionController&&(this._activeTransitionController.cancel(),this._activeTransitionController.timeoutId&&clearTimeout(this._activeTransitionController.timeoutId),this._carouselState.isTransitioning=!1,this._activeTransitionController=null);const o=this.process.currentImage.imageNode,r=(s=this._carouselOptions.transition,R[s]||F);var s;const a=this._carouselState.direction||"forward";this._carouselState.isTransitioning=!0;let l=!1;this._activeTransitionController={cancel:()=>{l=!0}};try{await r(o,i,a,this._carouselOptions.transitionDuration,this._mainImageContainer);const e=i.__transitionTimeoutId;e&&this._activeTransitionController&&(this._activeTransitionController.timeoutId=e),l||this.updateCurrentImage(n)}catch(c){l||console.error("zPhotoCarousel: Transition error:",c)}finally{this._carouselState.isTransitioning=!1,this._activeTransitionController=null}}getCenterImageOptions(){const e={marginPercent:.05,allowUpscale:!1,reservedSpaces:{}};if(this._carouselOptions.enableThumbnails){const t=this._carouselOptions.thumbnailHeight,n=this._carouselOptions.thumbnailPosition;"bottom"===n?e.reservedSpaces.bottom=t:"top"===n?e.reservedSpaces.top=t:"left"===n?e.reservedSpaces.left=t:"right"===n&&(e.reservedSpaces.right=t)}return e}updateCurrentImage(e){const t=e.imageNode,n=e.index,i=this._mainImageContainer.getBoundingClientRect();this.process.currentImage={image:e,imageNode:t,animate:!1,factor:1,distanceFactor:1,scale:1,origin:{width:0,height:0,x:0,y:0,scale:1,min:.3,max:5},center:{x:i.left+i.width/2,y:i.top+i.height/2},minScale:.3,maxScale:5,x:0,y:0,width:()=>this.process.currentImage.imageNode.offsetWidth,height:()=>this.process.currentImage.imageNode.offsetHeight};const o=this._imageStates.get(n);if(o&&o.visited)this.setImageTransform(o.scale,o.x,o.y,!1);else{this.centerImageWithOptions(this.getCenterImageOptions());const e=this.getImageState();e&&this._imageStates.set(n,{scale:e.scale,x:e.x,y:e.y,visited:!0})}e.loaded&&e.evener&&e.evener.apply(),this.setupStateTracking(n)}setupStateTracking(e){let t;const n=()=>{const t=this.process.currentImage;if(!t||t.image.index!==e)return;const n=this.getImageState();n&&this._imageStates.set(e,{scale:n.scale,x:n.x,y:n.y,visited:!0})},i=()=>{clearTimeout(t),t=setTimeout(n,300)},o=this._mainImageContainer,r=i,s=i,a=i;o.__stateTrackingCleanup&&o.__stateTrackingCleanup(),o.addEventListener("wheel",r,{passive:!0}),o.addEventListener("mouseup",s),o.addEventListener("touchend",a),o.__stateTrackingCleanup=()=>{clearTimeout(t),o.removeEventListener("wheel",r),o.removeEventListener("mouseup",s),o.removeEventListener("touchend",a)}}next(){if(this._carouselState.isTransitioning)return;const e=this.getNextIndex();e!==this._carouselState.currentIndex&&this.navigateTo(e,"forward")}previous(){if(this._carouselState.isTransitioning)return;const e=this.getPreviousIndex();e!==this._carouselState.currentIndex&&this.navigateTo(e,"backward")}goTo(e){if(this._carouselState.isTransitioning||e<0||e>=this._carouselState.totalImages||e===this._carouselState.currentIndex)return;const t=e>this._carouselState.currentIndex?"forward":"backward";this.navigateTo(e,t)}first(){this.goTo(0)}last(){this.goTo(this._carouselState.totalImages-1)}async navigateTo(e,t){const n=this._carouselState.currentIndex,i=this.process.images[e];let o=!1;const r={from:n,to:e,direction:t,image:i,instance:this,preventDefault:()=>{o=!0},stopPropagation:()=>{}};for(const a of this._navigateCallbacks)if(a(r),o)return;this._carouselState.currentIndex=e,this._carouselState.direction=t,await this.displayImage(e,!0),this.updateUIComponents();const s={index:e,image:i,total:this._carouselState.totalImages,instance:this};for(const a of this._slideChangeCallbacks)a(s);this._preloader&&this._preloader.preloadAdjacent(e)}updateUIComponents(){const e=this._carouselState.currentIndex;this._counter&&this._counter.update(e+1,this._carouselState.totalImages),this._thumbnailBar&&this._thumbnailBar.setActive(e),this._navigationArrows&&this._navigationArrows.updateDisabledState(e,this._carouselState.totalImages,this._carouselOptions.loop)}getNextIndex(){const e=this._carouselState.currentIndex;return e===this._carouselState.totalImages-1?this._carouselOptions.loop?0:e:e+1}getPreviousIndex(){const e=this._carouselState.currentIndex,t=this._carouselState.totalImages;return 0===e?this._carouselOptions.loop?t-1:e:e-1}play(){this._carouselState.isPlaying||(this._carouselState.isPlaying=!0,this._carouselState.playTimer=setInterval(()=>{this.next()},this._carouselOptions.autoPlayInterval))}pause(){this._carouselState.isPlaying&&(this._carouselState.isPlaying=!1,this._carouselState.playTimer&&(clearInterval(this._carouselState.playTimer),this._carouselState.playTimer=null))}togglePlay(){this._carouselState.isPlaying?this.pause():this.play()}getCurrentIndex(){return this._carouselState.currentIndex}getTotalImages(){return this._carouselState.totalImages}getImages(){return this.process.images}isPlaying(){return this._carouselState.isPlaying}onNavigate(e,t){if("function"==typeof e)if(t){const t=this._navigateCallbacks.indexOf(e);t>-1&&this._navigateCallbacks.splice(t,1)}else this._navigateCallbacks.push(e)}onSlideChange(e,t){if("function"==typeof e)if(t){const t=this._slideChangeCallbacks.indexOf(e);t>-1&&this._slideChangeCallbacks.splice(t,1)}else this._slideChangeCallbacks.push(e)}setupPauseOnHover(e){let t=!1;const n=()=>{this._carouselState.isPlaying?(t=!1,this.pause()):t=!0},i=()=>{!t&&this._carouselOptions.autoPlay&&this.play()};this._hoverHandlers={mouseenter:n,mouseleave:i},e.addEventListener("mouseenter",n),e.addEventListener("mouseleave",i)}cleanupPauseOnHover(){if(!this._hoverHandlers)return;const e=this.process.preview?.container;e&&(e.removeEventListener("mouseenter",this._hoverHandlers.mouseenter),e.removeEventListener("mouseleave",this._hoverHandlers.mouseleave)),this._hoverHandlers=null}close(){this.pause(),this._mainImageContainer&&this._mainImageContainer.__stateTrackingCleanup&&(this._mainImageContainer.__stateTrackingCleanup(),delete this._mainImageContainer.__stateTrackingCleanup),this._imageStates.clear(),this._thumbnailBar?.destroy(),this._thumbnailBar=void 0,this._keyboardNav?.destroy(),this._keyboardNav=void 0,this._swipeDetector?.destroy(),this._swipeDetector=void 0,this._navigationArrows?.destroy(),this._navigationArrows=void 0,this._counter?.destroy(),this._counter=void 0,this.cleanupClickHandlers(),this.cleanupPauseOnHover(),this._mainImageContainer&&(this._mainImageContainer.innerHTML=""),super.close()}cleanupClickHandlers(){this._clickHandlers.forEach((e,t)=>{t.removeEventListener("click",e)}),this._clickHandlers.clear(),this._originalEventHandlers.forEach((e,t)=>{e.evener&&e.evener.apply()}),this._originalEventHandlers.clear()}getContainerPreview(){const e=this,t=this.process;let n,i,o,r=!1,s=!1;function a(e){0===e.button&&(s=!0,t.flags.isMoved||(r=!1))}function l(e){(t.flags.isMoved||s)&&(r=!0)}function c(n){const i=t.context.body||t.context.getElementsByTagName("body")[0];if((this===n.target||!i)&&!r&&s)try{e.close()}catch(o){}r=!1,s=!1,n.stopPropagation(),n.preventDefault()}return t.container?(i=t.container,o=t.context):(i=t.context.createElement("DIV"),i.setAttribute("class","ZPhotoZoom"),n=t.context.body||t.context.getElementsByTagName("body")[0],o=i),{container:i,apply:function(){n&&n.appendChild(i)},evener:function(e){e?(o.removeEventListener("mousedown",a),o.removeEventListener("mousemove",l),o.removeEventListener("mouseup",c)):setTimeout(function(){o.addEventListener("mousedown",a),o.addEventListener("mousemove",l),o.addEventListener("mouseup",c)},100)}}}},e.zPhotoZoom=w,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
//# sourceMappingURL=zphotozoom.umd.js.map
