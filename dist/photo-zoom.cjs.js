"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});var e=Object.defineProperty,t=(t,n,r)=>((t,n,r)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r)(t,n+"",r);function n(e,t,n,r){const o=t.width/t.height;let a,c;if(e.landscape)a=8*t.width/10,c=a/e.prop,c>t.height&&(c=9*t.height/10,a=c*e.prop);else if(o>=e.prop)c=9*t.height/10,a=c*e.prop;else{const n=e.prop-o;c=9*t.height/10-8*t.height/10*n,a=c*e.prop}let i=Math.min(a/e.width,c/e.height);return"number"!=typeof n||n<=0?i<(n=.3)&&(n=i):i<n&&(i=n),"number"!=typeof r||r<n?i>(r=5)&&(r=i,i=3):i>r&&(i=r),{width:a,height:c,x:(t.width-a)/2,y:(t.height-c)/2,scale:i,min:n,max:r}}function r(){const e=this,t=this._process;let n=!1,r=!1;for(let a=0;a<t.eventsClose.length;a++){if(t.eventsClose[a]({preventDefault:()=>{n=!0},stopPropagation:()=>{r=!0},target:t.currentImage.image.node,instance:e}),n)return;if(r)break}t.flags={isAnimated:!1,isMoved:!1,wheel:!1,movements:0,updateAttempt:!1,updated:!1,zoomIn:!1,loader:!1,stoped:t.flags.stoped};try{t.currentImage.image.evener.remove()}catch(o){}if(t.container)t.preview.container.removeChild(t.currentImage.imageNode),t.preview.evener(!0);else{(t.context.body||t.context.getElementsByTagName("body")[0]).removeChild(t.preview.container)}t.flags.loader&&(clearTimeout(t.flags.loader),t.flags.loader=!1),t.preview=!1,t.loader=!1}function o(e,t){const n=this._process;n.container||(n.loader&&(n.preview.container.removeChild(n.loader),n.flags.loader&&(clearTimeout(n.flags.loader),n.flags.loader=!1)),e?(n.loader=n.context.createElement("SPAN"),n.loader.innerText=" "+e):n.loader=n.context.createElement("ZLOADER"),n.loader.style.opacity="1",n.preview.container.appendChild(n.loader),t&&a.call(this,t))}function a(e){const t=this._process;t.loader&&(t.flags.loader&&clearTimeout(t.flags.loader),t.loader.style.transition="opacity "+e+"ms",t.flags.loader=setTimeout(()=>{t.preview&&t.preview.container.removeChild(t.loader),t.loader=!1,t.flags.loader=!1},e))}function c(){const e=this,t=this._process;let n,o,a,c=!1,i=!1;function s(e){0===e.button&&(i=!0,t.flags.isMoved||(c=!1))}function l(e){(t.flags.isMoved||i)&&(c=!0)}function m(n){const o=t.context.body||t.context.getElementsByTagName("body")[0];if((this===n.target||!o)&&!c&&i)try{r.call(e)}catch(a){}c=!1,i=!1,n.stopPropagation(),n.preventDefault()}return t.container?(o=t.container,a=t.context):(o=t.context.createElement("DIV"),o.setAttribute("class","ZPhotoZoom"),n=t.context.body||t.context.getElementsByTagName("body")[0],a=o),{container:o,apply:function(){n&&n.appendChild(o)},evener:function(e){e?(a.removeEventListener("mousedown",s),a.removeEventListener("mousemove",l),a.removeEventListener("mouseup",m)):setTimeout(function(){a.addEventListener("mousedown",s),a.addEventListener("mousemove",l),a.addEventListener("mouseup",m)},100)}}}function i(e){const t=this,r=this._process;let a,i=!1,l=!1;for(let n=0;n<r.eventsOpen.length;n++){if(r.eventsOpen[n]({preventDefault:()=>{i=!0},stopPropagation:()=>{l=!0},target:e.node,instance:t}),i)return;if(l)break}let m={};r.preview=c.call(t),e.loaded?(a=e.imageNode,r.preview.container.appendChild(a),m=n(e,s.call(t).nf,r.scaleLimit.min,r.scaleLimit.max),p.call(t,m.scale,{x:m.x/m.scale,y:m.y/m.scale})):o.call(t),r.preview.apply(),r.preview.evener();const u=s.call(t).nf;r.currentImage={image:e,imageNode:a,animate:!1,factor:m.scale,distanceFactor:1,scale:m.scale,origin:m,center:{x:u.cx,y:u.cy},minScale:m.min,maxScale:m.max,x:m.x,y:m.y,width:function(){return r.currentImage.imageNode.offsetWidth},height:function(){return r.currentImage.imageNode.offsetHeight}},e.loaded&&e.evener.apply()}function s(){const e=this._process.container;if(e){const t=this._process.container.getBoundingClientRect();return{container:e,nf:{width:t.width,height:t.height,top:t.top,left:t.left,cx:t.left+t.width/2,cy:t.top+t.height/2,x:0,y:0}}}return{container:null,nf:{width:window.innerWidth,height:window.innerHeight,top:0,left:0,cx:window.innerWidth/2,cy:window.innerHeight/2,x:0,y:0}}}function l(e){const t=this,n=this._process;let r=0,o=null,a=!1,c=!1,i=null;function l(e){let r=0,o=0;const a=n.context.documentElement.scrollTop||n.context.body.scrollTop,c=n.context.documentElement.scrollLeft||n.context.body.scrollLeft,i=s.call(t).nf;r=i.top+a,o=i.left+c;const l=[];for(let t=0;t<e.length;t++)l.push({x:e[t].pageX-o,y:e[t].pageY-r});return l}function f(e){if(!c){const n=(new Date).getTime();return n-i<320&&(g.call(t,o[0]),p(),e.stopPropagation(),e.preventDefault()),n}return 0}function p(e){i=e||null,a=!1}function h(){o=null,c=!1}function v(e){if("mousedown"===e.type){const t=e;0===t.button&&(a=!0,o=l([t]),e.stopPropagation(),e.preventDefault())}else if("touchstart"===e.type){const t=e;a=!0,r=t.touches.length,o=l(t.touches)}}function I(e){if(!a&&!o){let n=1;e.deltaY<0&&(n=-1),u.call(t,l([e])[0],n),e.stopPropagation(),e.preventDefault()}}function x(e){if(a)if(0===e.button){c=!0;const n=l([e]);o&&m.call(t,o[0],n[0]),o=n,e.stopPropagation(),e.preventDefault()}else p(i),h()}function y(e){if(r>0)if(o)if(1===r){c=!0;const n=l(e.touches);m.call(t,o[0],n[0]),o=n,e.stopPropagation(),e.preventDefault()}else r>=2&&(o.length<2?o=l(e.touches):(d.call(t,o,l(e.touches)),e.stopPropagation(),e.preventDefault()));else o=l(e.touches)}function w(e){0===e.button&&(a&&(i=f(e)),p(i),h())}function b(e){a?(1===r&&(i=f(e),h(),n.currentImage.distanceFactor=1),r=e.touches.length,0===r?(p(),h(),n.flags.movements=0,n.currentImage.distanceFactor=1):h()):(n.flags.movements=0,n.currentImage.distanceFactor=1,p(),h())}return{remove:function(){e.removeEventListener("wheel",I,{passive:!1}),e.removeEventListener("mousedown",v,{passive:!1}),e.removeEventListener("touchstart",v,{passive:!1}),e.removeEventListener("mousemove",x),e.removeEventListener("touchmove",y,{passive:!1}),n.context.removeEventListener("mouseup",w,{passive:!1,capture:!0}),n.context.removeEventListener("touchend",b,{passive:!1,capture:!0})},apply:function(){r=0,o=null,a=!1,c=!1,i=null,e.addEventListener("wheel",I,{passive:!1}),e.addEventListener("mousedown",v,{passive:!1}),e.addEventListener("touchstart",v,{passive:!1}),e.addEventListener("mousemove",x),e.addEventListener("touchmove",y,{passive:!1}),n.context.addEventListener("mouseup",w,{passive:!1,capture:!0}),n.context.addEventListener("touchend",b,{passive:!1,capture:!0})}}}function m(e,t){const n=this._process;n.flags.movements||n.flags.isAnimated||(n.flags.isMoved=!0,n.currentImage.x+=t.x-e.x,n.currentImage.y+=t.y-e.y,p.call(this,n.currentImage.factor,{x:n.currentImage.x/n.currentImage.factor,y:n.currentImage.y/n.currentImage.factor},!1))}function u(e,t){const n=this._process;if(n.flags.updateAttempt||n.flags.stoped)return;t>0?n.currentImage.scale-=.05:n.currentImage.scale+=.05;const r=n.currentImage.factor;n.currentImage.scale=Math.min(n.currentImage.maxScale,Math.max(n.currentImage.scale,n.currentImage.minScale)),n.currentImage.factor=n.currentImage.scale;const o=n.currentImage.imageNode.getBoundingClientRect(),a=s.call(this).nf;n.currentImage.x-=(n.currentImage.factor/r-1)*(e.x-o.left+a.left),n.currentImage.y-=(n.currentImage.factor/r-1)*(e.y-o.top+a.top),p.call(this,n.currentImage.factor,{x:n.currentImage.x/n.currentImage.factor,y:n.currentImage.y/n.currentImage.factor}),n.currentImage.center=e,n.flags.wheel=setTimeout(function(){n.flags.wheel=!1},600)}function g(e){const t=this._process;if(!(t.flags.isAnimated||t.flags.updateAttempt||t.flags.stoped))if(t.currentImage.scale<=t.currentImage.origin.scale){const n=t.currentImage.factor,r=t.currentImage.imageNode.getBoundingClientRect(),o=s.call(this).nf;t.currentImage.scale=Math.min(t.currentImage.maxScale,Math.max(t.currentImage.scale+2,t.currentImage.minScale)),t.currentImage.factor=t.currentImage.scale,t.currentImage.x-=(t.currentImage.factor/n-1)*(e.x-r.left+o.left),t.currentImage.y-=(t.currentImage.factor/n-1)*(e.y-r.top+o.top),t.currentImage.center=e,p.call(this,t.currentImage.factor,{x:t.currentImage.x/t.currentImage.factor,y:t.currentImage.y/t.currentImage.factor},!0)}else f.call(this)}function f(){const e=this._process;e.currentImage.scale=e.currentImage.origin.scale,e.currentImage.factor=e.currentImage.origin.scale,e.currentImage.x=e.currentImage.origin.x,e.currentImage.y=e.currentImage.origin.y,e.currentImage.minScale=e.currentImage.origin.min,e.currentImage.maxScale=e.currentImage.origin.max;const t=s.call(this).nf;e.currentImage.center={x:t.cx,y:t.cy},p.call(this,e.currentImage.factor,{x:e.currentImage.x/e.currentImage.factor,y:e.currentImage.y/e.currentImage.factor},!0)}function d(e,t){const n=this,r=this._process;if(r.flags.updateAttempt||r.flags.stoped)return;const o=r.currentImage.distanceFactor;r.currentImage.distanceFactor=function(e,t){function n(e,t){const n=e.x-t.x,r=e.y-t.y;return Math.sqrt(n*n+r*r)}return n(t[0],t[1])/n(e[0],e[1])}(e,t);const a=r.currentImage.distanceFactor/o;a<1?r.flags.zoomIn||(r.flags.zoomIn=!0):r.flags.zoomIn&&(r.flags.zoomIn=!1),r.currentImage.scale*=a;const c=function(e){if(1===e.length)return{x:e[0].x,y:e[0].y};{const t=Array.prototype.slice.call(e).map(e=>({x:e.x,y:e.y}));return{x:t.map(e=>e.x).reduce((e,t)=>e+t)/t.length,y:t.map(e=>e.y).reduce((e,t)=>e+t)/t.length}}}(t),i=r.currentImage.factor;r.currentImage.factor=Math.min(r.currentImage.maxScale,Math.max(r.currentImage.scale,r.currentImage.minScale));const l=r.currentImage.imageNode.getBoundingClientRect();if(r.flags.movements&&r.flags.movements>1){const e=s.call(n).nf;r.currentImage.x-=(r.currentImage.factor/i-1)*(c.x-l.left+e.left)-(c.x-r.currentImage.center.x),r.currentImage.y-=(r.currentImage.factor/i-1)*(c.y-l.top+e.top)-(c.y-r.currentImage.center.y),r.flags.updated||r.flags.isAnimated||(r.flags.updated=!0,setTimeout(function(){p.call(n,r.currentImage.factor,{x:r.currentImage.x/r.currentImage.factor,y:r.currentImage.y/r.currentImage.factor}),r.flags.updated=!1},0))}r.currentImage.center=c,r.flags.movements+=1}function p(e,t,n){const r=this._process;if(r.flags.isAnimated)return;r.flags.isAnimated=!0;let a=Math.round(100*e);a<100&&(a=" "+a),o.call(this,a+"%",800),setTimeout(function(){r.flags.isAnimated=!1;const o="scale3d("+e+","+e+",1) translate3d("+t.x+"px,"+t.y+"px,0px)",a="scale("+e+", "+e+") translate("+t.x+"px,"+t.y+"px)";r.currentImage.animate&&clearTimeout(r.currentImage.animate),n?r.currentImage.animate=setTimeout(function(){r.currentImage.imageNode.style.transition="",r.currentImage.animate=!1,r.flags.isMoved=!1},500):(r.currentImage.imageNode.style.transition="",r.currentImage.animate=setTimeout(function(){r.flags.isMoved=!1},100)),r.currentImage.imageNode.style.transformOrigin="top left",r.currentImage.imageNode.style.webkitTransformOrigin="top left",r.currentImage.imageNode.style.transform=o,r.currentImage.imageNode.style.webkitTransform=o,r.currentImage.imageNode.style.mozTransform=a,r.currentImage.imageNode.style.msTransform=a,r.currentImage.imageNode.style.oTransform=a})}function h(){const e=this,t=this._process,r=t.selector,o=t.context;function c(r){!function(e,t){const n=new Image;n.onload=function(){const e=this.height,n=this.width;t.call(this,n,e)},n.src=e}(r.src,function(o,c){r.imageNode=this,r.loaded=!0,r.width=o,r.height=c,r.prop=o/c,r.landscape=o>=c,r.evener=l.call(e,this),t.preview&&t.currentImage.image===r&&(t.currentImage.imageNode=this,t.preview.container.appendChild(t.currentImage.imageNode),t.currentImage.origin=n(r,s.call(e).nf,t.scaleLimit.min,t.scaleLimit.max),a.call(e,480),f.call(e),r.evener.apply())})}const i=[];let m=[];if(r&&"string"==typeof r&&o&&Node.DOCUMENT_NODE===o.nodeType)if(/\s+[^#]|>|\[|\.|,/.test(r))m=Array.from(o.querySelectorAll(r));else{const e=o.querySelector(r);e&&(m=[e])}if((Array.isArray(m)||m instanceof NodeList)&&m.length>0)for(let n=0;n<m.length;n++){const e=m[n],t={node:e,src:""};let r=!1;if("IMG"===e.tagName&&e.src)r=e.src;else{const t=getComputedStyle(e).backgroundImage;if(t)if(/^url\(/.test(t))try{const e=t.match(/url\(["']?([^"']*)["']?\)/);r=!!e&&e[1]}catch(u){r=!1}else r=!1}r&&(t.src=r,c(t),i.push(t))}return i}function v(e,t){const n=this;let r=!1,o=!1;function a(t){o||i.call(n,e),o=!1,r=!1}function c(){r=!0}function s(){r&&(o=!0)}t?(e.node.removeEventListener("click",a),e.node.removeEventListener("touchstart",c),e.node.removeEventListener("touchend",a),e.node.removeEventListener("touchmove",s)):(e.node.addEventListener("click",a),e.node.addEventListener("touchstart",c),e.node.addEventListener("touchend",a),e.node.addEventListener("touchmove",s))}function I(){const e=this._process;if(e.images=h.call(this),e.images.length>0)for(let t=0;t<e.images.length;t++)v.call(this,e.images[t])}function x(e,t){Object.defineProperty(this,"_process",{value:{preview:null,loader:null,eventsOpen:[],eventsClose:[],images:[],flags:{isAnimated:!1,isMoved:!1,wheel:!1,movements:0,updateAttempt:!1,updated:!1,zoomIn:!1,loader:!1,stoped:!1},container:e.container,scaleLimit:{min:e.min,max:e.max},selector:e.el,context:t||document,currentImage:null},configurable:!1,enumerable:!1,writable:!1})}function y(){const e=this,t=e._process;I.call(e),window.addEventListener("resize",function(){if(t.preview){const r=n(t.currentImage.image,s.call(e).nf,t.scaleLimit.min,t.scaleLimit.max);t.currentImage.origin=r,function n(){t.flags.updateAttempt=setTimeout(function(){t.flags.isAnimated?n():(f.call(e),t.flags.updateAttempt=!1)},70)}()}})}class w{constructor(e,n){if(t(this,"_process"),(()=>{if(document.getElementById("photo-zoom-styles"))return;const e=document.createElement("style");e.id="photo-zoom-styles",e.textContent="\n    .ZPhotoZoom {\n      position: fixed;\n      left: 0;\n      top: 0;\n      width: 100vw;\n      height: 100vh;\n      background-color: rgba(0, 0, 0, 0.7);\n      z-index: 999999999;\n      -webkit-user-select: none;\n      -moz-user-select: none;\n      -ms-user-select: none;\n      user-select: none;\n    }\n\n    .ZPhotoZoom img {\n      position: absolute;\n      cursor: grab;\n    }\n\n    .ZPhotoZoom img:active {\n      cursor: grabbing;\n    }\n\n    .ZPhotoZoom span {\n      color: white;\n      line-height: 30px;\n      font-weight: bold;\n      position: fixed;\n      top: calc(50vh - 25px);\n      left: calc(50vw - 15px);\n      background-color: rgba(114, 123, 135, 0.5);\n      width: 50px;\n      height: 30px;\n      display: inline-block;\n      vertical-align: middle;\n      border-radius: 5px;\n      text-align: center;\n    }\n\n    .ZPhotoZoom zloader {\n      position: fixed;\n      top: calc(50vh - 50px);\n      left: calc(50vw - 50px);\n      width: 40px;\n      height: 40px;\n      display: inline-block;\n      vertical-align: middle;\n      border-radius: 40px;\n      border: 6px solid rgba(114, 123, 135, 0.4);\n    }\n\n    .ZPhotoZoom zloader:after {\n      content: '';\n      position: absolute;\n      top: -6px;\n      left: -6px;\n      bottom: -6px;\n      right: -6px;\n      width: 40px;\n      height: 40px;\n      border-radius: 40px;\n      border: 6px solid transparent;\n      border-top-color: rgba(38, 38, 38, 0.27);\n      -webkit-animation: zPhotoZoomSpin 1s linear infinite;\n      animation: zPhotoZoomSpin 1s linear infinite;\n    }\n\n    @keyframes zPhotoZoomSpin {\n      0% {\n        -webkit-transform: rotate(0deg);\n        transform: rotate(0deg);\n      }\n      100% {\n        -webkit-transform: rotate(360deg);\n        transform: rotate(360deg);\n      }\n    }\n  ",document.head.appendChild(e)})(),!(this instanceof w))return console.error("zPhotoZoom is a class and can only be called with the keyword 'new'");e&&("object"==typeof e&&x.call(this,e,n),"string"==typeof e.el&&y.call(this))}stop(){this._process.flags.stoped=!0}resume(){this._process.flags.stoped=!1}reset(){this._process.preview&&f.call(this)}close(){this._process.preview&&r.call(this)}update(){const e=this._process;e.preview&&p.call(this,e.currentImage.factor,{x:e.currentImage.x/e.currentImage.factor,y:e.currentImage.y/e.currentImage.factor})}change(e){const t=this._process;if("string"==typeof e){t.preview&&r.call(this);for(let e=0;e<t.images.length;e++)v.call(this,t.images[e],!0);t.selector=e,t.images=[],I.call(this)}}onOpen(e,t){const n=this._process;if("function"==typeof e)if(t)for(let r=n.eventsOpen.length-1;r>=0;r--)n.eventsOpen[r]===e&&n.eventsOpen.splice(r,1);else n.eventsOpen.push(e)}onClose(e,t){const n=this._process;if("function"==typeof e)if(t)for(let r=n.eventsClose.length-1;r>=0;r--)n.eventsClose[r]===e&&n.eventsClose.splice(r,1);else n.eventsClose.push(e)}}exports.default=w,exports.zPhotoZoom=w;
//# sourceMappingURL=photo-zoom.cjs.js.map
